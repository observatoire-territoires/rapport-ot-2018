"use strict";console.log("Etat du document : "+document.readyState);var navBulletMenu=document.querySelectorAll(".nav-bullet-menu"),niv1HIntro2Button=document.querySelector(".niv1-h-intro-2-button"),sectionNavBullet=document.querySelectorAll(".section-nav-bullet");function alternativeColorBullet(){for(var e=document.querySelectorAll(".nav-bullet-menu"),a=function(t){var e=t.getBoundingClientRect();return e.top<=10&&10<=e.bottom},t=0;t<sectionNavBullet.length;t++)a(sectionNavBullet[t])?e[t].classList.add("nav-bullet-menu-visible"):e[t].classList.remove("nav-bullet-menu-visible");document.addEventListener("scroll",function(){for(var t=0;t<sectionNavBullet.length;t++)a(sectionNavBullet[t])?e[t].classList.add("nav-bullet-menu-visible"):e[t].classList.remove("nav-bullet-menu-visible")})}niv1HIntro2Button.addEventListener("click",function(){window.location="#onze_pour_cent_des_francais_ont_demenage_en_2014"});var intersectionCallback=function(t){t.forEach(function(a){Array.from(sectionNavBullet).forEach(function(t,e){t==a.target&&function(t){if(a.boundingClientRect.top<=10&&-10<=a.boundingClientRect.bottom){navBulletMenu[t].style.backgroundColor="#779933";var e=Array.from(navBulletMenu);e.splice(t,1),e.forEach(function(t){t.style.backgroundColor="#fff"})}}(e)})})};function thresholdList(){for(var t=[],e=1;e<=3500;e++){var a=e/3500;t.push(a)}return t.push(0),t}var observerOptions={root:null,rootMargin:"0px",threshold:thresholdList()};if("IntersectionObserver"in window){var io_nav=new IntersectionObserver(intersectionCallback,observerOptions);Array.from(sectionNavBullet).forEach(function(t){io_nav.observe(t)})}else alternativeColorBullet();console.log("Etat du document : "+document.readyState);var notesStep=document.querySelectorAll(".notes-step"),notesBoxRef=document.querySelectorAll(".notes-box-ref"),noteIsInViewport=function(t){var e=t.getBoundingClientRect();return 0<=e.top&&0<=e.left&&e.right<=(window.innerWidth||document.documentElement.clientWidth)&&e.bottom<=(window.innerHeight||document.documentElement.clientHeight)};document.addEventListener("scroll",function(){for(var t=0;t<notesStep.length;t++)noteIsInViewport(notesStep[t])?notesBoxRef[t].classList.add("notes-box-div-visible"):notesBoxRef[t].classList.remove("notes-box-div-visible")});var cHelpButton=document.querySelectorAll(".c-help-button"),helpButton=document.querySelectorAll(".help-button"),helpBody=document.querySelectorAll(".help-body"),displayToggle=1;function showHelpButton(t){helpBody[t].style.display="block",cHelpButton[t].style.borderWidth="1px",cHelpButton[t].style.background=" #282828"}function hideHelpButton(t){helpBody[t].style.display="none",cHelpButton[t].style.borderWidth="0px",cHelpButton[t].style.background="none"}function deplaceElementSmallDevice(){var t=window.matchMedia("(min-width: 1024px)").matches;0==t&&firstVisit(t),1==t&&(firstVisit(t),console.log("grand écran"))}Array.from(helpButton).forEach(function(t,e){t.addEventListener("click",function(){++displayToggle%2==0?showHelpButton(e):hideHelpButton(e)})}),window.addEventListener("resize",function(){deplaceElementSmallDevice()}),document.onreadystatechange=function(){"complete"==document.readyState&&deplaceElementSmallDevice()};var alertLargeDevice=document.querySelector("#alert-large-device"),alertSmallDevice=document.querySelector("#alert-small-device"),body=document.querySelector("body"),selectionGlobal=document.querySelector(".global"),selectionHtml=document.querySelector("html");function firstVisit(e){Array.from(document.querySelectorAll(".button-alert")).forEach(function(t,e){t.addEventListener("click",function(){0==e?hideAlertLargeDevice():hideAlertSmallDevice()})}),document.onkeydown=function(t){27!=(t=t||window.event).keyCode&&13!=t.keyCode&&8!=t.keyCode||(e?hideAlertLargeDevice():hideAlertSmallDevice(),Array.from(helpButton).forEach(function(t,e){hideHelpButton(e)}))},window.sessionStorage.getItem("nouvelleSession")?(console.log("ce n'est pas la première visite"),e?hideAlertLargeDevice():hideAlertSmallDevice()):(window.sessionStorage.setItem("nouvelleSession","true"),console.log("c'est la première visite"),e?showAlertLargeDevice():showAlertSmallDevice())}function showAlertLargeDevice(){alertLargeDevice.style.display="flex",body.style.overflow="hidden",selectionHtml.style.overflow="hidden",selectionGlobal.style.opacity=.2,selectionGlobal.style.pointerEvents="none",selectionGlobal.style.userSelect="none"}function hideAlertLargeDevice(){alertLargeDevice.style.display="none",body.style.overflow="initial",selectionHtml.style.overflow="initial",selectionGlobal.style.opacity=1,selectionGlobal.style.pointerEvents="initial",selectionGlobal.style.userSelect="initial"}function showAlertSmallDevice(){alertSmallDevice.style.display="flex",body.style.overflow="hidden",selectionHtml.style.overflow="hidden",selectionGlobal.style.opacity=.2,selectionGlobal.style.pointerEvents="none",selectionGlobal.style.userSelect="none"}function hideAlertSmallDevice(){alertSmallDevice.style.display="none",body.style.overflow="initial",selectionHtml.style.overflow="initial",selectionGlobal.style.opacity=1,selectionGlobal.style.pointerEvents="initial",selectionGlobal.style.userSelect="initial"}function graph1(){var n=50,l=document.querySelector(".niv2 p").clientWidth,t=600,o=d3.select("#c-svg-01").append("svg").attr("height",t).attr("width",l),s=o.append("g").attr("transform","translate("+l/2+",300)");d3.formatDefaultLocale({decimal:",",thousands:" ",grouping:[3]});var c=d3.scaleOrdinal().domain(["immob","mob_com","mob_dep","mob_reg","mob_france","mob_all"]).range(["#eaeaea","#7b7fbc","#7dbd9f","#f8c351","#f18757","#e85754"]);d3.csv("data/csv/data-01.csv").then(function(t){var e=d3.forceSimulation().force("x",d3.forceX().strength(.05).x(function(t){return a[t.type_mob].x})).force("y",d3.forceY().strength(.05).y(function(t){return a[t.type_mob].y})).force("collide",d3.forceCollide(5)).force("charge",d3.forceManyBody().strength(-1)),a={mob_com:{x:l/6,y:-200},mob_dep:{x:l/6,y:-100},mob_reg:{x:l/6,y:0},mob_france:{x:l/6,y:100},mob_all:{x:l/6,y:200},immob:{x:-l/6,y:0}};var r=s.append("g").selectAll(".people");(r=r.data(t)).exit().remove(),r=r.enter().append("circle").attr("class","people").attr("r",2).attr("fill",function(t){return c(t.type_mob)}).merge(r),e.nodes(t).on("tick",function(){r.attr("cx",function(t){return t.x}).attr("cy",function(t){return t.y})}),o.append("text").attr("class","extra label-change").attr("x",20).attr("y",25).attr("fill","#f0f0f0").text("En 2014, en France"),o.append("line").attr("class","extra line-extra").attr("x1",20).attr("y1",5).attr("x2",180).attr("y2",5).attr("stroke","#fff"),o.append("line").attr("class","extra line-extra").attr("x1",20).attr("y1",35).attr("x2",180).attr("y2",35).attr("stroke","#fff"),o.append("text").attr("class","label-text").attr("x",50+l/4).attr("y",200-n).attr("text-anchor","middle").attr("fill","#f0f0f0").text("89 % des individus"),o.append("text").attr("class","label-text").attr("x",50+l/4).attr("y",200-n+15).attr("text-anchor","middle").attr("fill","#f0f0f0").text("n'ont pas changé de logement"),o.append("text").attr("class","label-text").attr("x",4*l/6).attr("y",100-n).attr("text-anchor","middle").attr("fill","#f0f0f0").text("4 % sont restés"),o.append("text").attr("class","label-text").attr("x",4*l/6).attr("y",100-n+15).attr("text-anchor","middle").attr("fill","#f0f0f0").text("dans la même commune"),o.append("text").attr("class","label-text").attr("x",4*l/6).attr("y",200-n).attr("text-anchor","middle").attr("fill","#f0f0f0").text("4,1 % ont changé de commune"),o.append("text").attr("class","label-text").attr("x",4*l/6).attr("y",200-n+15).attr("text-anchor","middle").attr("fill","#f0f0f0").text("au sein du même département"),o.append("text").attr("class","label-text").attr("x",4*l/6).attr("y",300-n).attr("text-anchor","middle").attr("fill","#f0f0f0").text("1,2 % ont changé de département"),o.append("text").attr("class","label-text").attr("x",4*l/6).attr("y",300-n+15).attr("text-anchor","middle").attr("fill","#f0f0f0").text("au sein de la même région"),o.append("text").attr("class","label-text").attr("x",4*l/6).attr("y",400-n).attr("text-anchor","middle").attr("fill","#f0f0f0").text("1,6 % ont changé"),o.append("text").attr("class","label-text").attr("x",4*l/6).attr("y",400-n+15).attr("text-anchor","middle").attr("fill","#f0f0f0").text("de région"),o.append("text").attr("class","label-text").attr("x",4*l/6).attr("y",500-n).attr("text-anchor","middle").attr("fill","#f0f0f0").text("0,4 % sont arrivés"),o.append("text").attr("class","label-text").attr("x",4*l/6).attr("y",500-n+15).attr("text-anchor","middle").attr("fill","#f0f0f0").text("de l'étranger")})}function graph2(){var p=20,u=20,f=60,m=100,g=document.querySelector(".niv2 p").clientWidth,x=d3.select("#c-svg-02").append("svg").attr("height",400).attr("width",g).attr("viewBox","0 0 "+g+" 400");d3.formatDefaultLocale({decimal:",",thousands:" ",grouping:[3]});var v=d3.format(".2n");d3.csv("data/csv/data-02.csv").then(function(t){t.forEach(function(t){t.meme_com=+t.meme_com,t.change_com=+t.change_com,t.change_dep=+t.change_dep,t.change_reg=+t.change_reg,t.change_int=+t.change_int});var e=t.columns.slice(1,6),a=d3.scaleLinear().domain([0,35]).rangeRound([m,g-u]),r=d3.scaleBand().domain(t.map(function(t){return t.periode})).rangeRound([p,400-f]).paddingInner(.5).align(.1),n=d3.scaleOrdinal().domain(e).range(["#7b7fbd","#7dbd9f","#f8c352","#f18757","#e85654"]),l=d3.axisBottom(a).tickFormat(function(t){return t+" %"}),o=d3.axisLeft(r).tickSizeOuter(0),s=d3.stack();x.append("g").attr("class","axis x_axis").attr("transform","translate(0,".concat(400-f,")")).call(l),x.select(".x_axis").selectAll("text").attr("y",10),x.append("g").attr("class","axis y_axis").attr("transform","translate(".concat(m,",0)")).call(o).select(".domain").remove(),x.selectAll(".serie").data(s.keys(e)(t)).enter().append("g").attr("class","serie").attr("fill",function(t){return n(t.key)}).selectAll("rect").data(function(t){return t}).enter().append("rect").attr("x",function(t){return a(t[0])}).attr("y",function(t){return r(t.data.periode)}).attr("width",function(t){return a(t[1])-a(t[0])}).attr("height",r.bandwidth()),x.append("text").attr("class","label").attr("transform","translate("+(g-u)+" ,"+(400-f/4)+")").style("text-anchor","end").attr("fill","#f0f0f0").text("Part des ménages ayant changé de logement");var c=d3.select("body").append("div").attr("class","my-popup");d3.selectAll("rect").on("mouseover",function(t){c.transition().duration(50).style("left",d3.event.pageX-20+"px").style("top",d3.event.pageY-120+"px").style("opacity",1).style("text-align","left"),c.html("\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<em>Chgt de logement dans la même commune</em> : <span>".concat(v(t.data.meme_com)," % </span>\n\t\t\t\t\t\t\t<br>\n\t\t\t\t\t\t\t<em>Chgt de commune dans le même département</em> : <span>").concat(v(t.data.change_com)," % </span>\n\t\t\t\t\t\t\t<br>\n\t\t\t\t\t\t\t<em>Chgt de département dans la même région</em> : <span>").concat(v(t.data.change_dep)," % </span>\n\t\t\t\t\t\t\t<br>\n\t\t\t\t\t\t\t<em>Chgt de région en France</em> : <span>").concat(v(t.data.change_reg)," % </span>\n\t\t\t\t\t\t\t<br>\n\t\t\t\t\t\t\t<em>Arrivée depuis l'étranger</em> : <span>").concat(v(t.data.change_int)," % </span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t"))}).on("mouseout",function(t){c.transition().duration(100).style("opacity",0)});var i=["Changement de logement dans la même commune","Changement de commune dans le même département","Changement de département dans la même région","Changement de région en France","Arrivée depuis l'étranger"],d=d3.select("#c-svg-02-legend").append("svg").attr("width",g).attr("height",100).selectAll(".legend").data(n.range()).enter().append("g").attr("class","legend");d.append("rect").attr("x",10+m).attr("y",function(t,e){return 20*e+5}).attr("width",23).attr("height",12).style("stroke","black").style("stroke-width",.1).style("fill",function(t){return t}),d.append("text").attr("fill","#f0f0f0").attr("x",40+m).attr("y",function(t,e){return 10+20*e}).attr("dy","0.5em").text(function(t,e){return i[e]})})}window.addEventListener("load",function(){"none"==getComputedStyle(document.querySelector(".c-graphic-min")).display&&graph1()}),window.addEventListener("load",function(){"none"==getComputedStyle(document.querySelector(".c-graphic-min")).display&&graph2()});var inputValues=["1968-1975","1975-1982","1982-1990","1990-1999","1999-2009","2009-2014"],input03=document.querySelector("#input-03"),output03=document.querySelector("#c-output-03"),output03Bullet=document.querySelector("#output-03-bullet");function graph03(){var x=20,v=20,y=document.querySelector(".niv2 p").clientWidth,h=d3.select("#c-svg-03").append("svg").attr("height",400).attr("width",y);d3.formatDefaultLocale({decimal:",",thousands:" ",grouping:[3]}),Promise.all([d3.json("data/map/rw_19681975.json"),d3.json("data/map/rw_19751982.json"),d3.json("data/map/rw_19821990.json"),d3.json("data/map/rw_19901999.json"),d3.json("data/map/rw_19992009.json"),d3.json("data/map/rw_20092014.json")]).then(function(t){var e=topojson.feature(t[0],t[0].objects.rw_19681975),a=topojson.feature(t[1],t[1].objects.rw_19751982),r=topojson.feature(t[2],t[2].objects.rw_19821990),n=topojson.feature(t[3],t[3].objects.rw_19901999),l=topojson.feature(t[4],t[4].objects.rw_19992009),o=topojson.feature(t[5],t[5].objects.rw_20092014),s=d3.geoConicConformal().fitSize([y,400],e),c=d3.geoPath().projection(s),i=h.append("g"),d=d3.scaleOrdinal().domain(["inf_-2","-2_-1","-1_0","0_1","1_2","2_3","sup_3"]).range(["#10524d","#229f97","#add9dc","#f9d7ad","#e89c3f","#ab6016","#693e0f"]);function p(){h.append("text").attr("class","extra label-change").attr("x",20).attr("y",25).attr("fill","#f0f0f0").text("Période"),h.append("line").attr("class","extra line-extra").attr("x1",v).attr("y1",5).attr("x2",180).attr("y2",5).attr("stroke","#fff"),h.append("line").attr("class","extra line-extra").attr("x1",v).attr("y1",35).attr("x2",180).attr("y2",35).attr("stroke","#fff")}function u(t,e){h.append("text").attr("class","label-change label-change2").attr("x",90).attr("y",25).attr("fill","#f0f0f0").text(e);i.selectAll(".rw").data(t).join("path").attr("d",c).attr("class","rw").attr("stroke","white").attr("stroke-width",.1).attr("fill",function(t){return d(t.properties.classe)})}p(),h.call(d3.zoom().on("zoom",function(){i.attr("transform",d3.event.transform)}).scaleExtent([1,6]).translateExtent([[0,0],[y,400]])),input03.oninput();var f=function(){var t=input03.value/input03.max;output03Bullet.style.left=t*input03.getBoundingClientRect().width*.9221018907+"px"};f(),input03.addEventListener("input",function(t){switch(f(),t.target.value){case"0":d3.selectAll(".label-change2").remove(),u(e.features,inputValues[0]);break;case"1":d3.selectAll(".label-change2").remove(),u(a.features,inputValues[1]);break;case"2":d3.selectAll(".label-change2").remove(),u(r.features,inputValues[2]);break;case"3":d3.selectAll(".label-change2").remove(),u(n.features,inputValues[3]);break;case"4":d3.selectAll(".label-change2").remove(),u(l.features,inputValues[4]);break;case"5":d3.selectAll(".label-change2").remove(),u(o.features,inputValues[5])}});var m=document.querySelector("#help-button3"),g=document.querySelectorAll(".break-section3");scrollama().setup({container:".scroll",graphic:".scroll-graphic",text:".scroll-text",step:".break-section3",debug:!1,offset:.6}).onStepEnter(function(t){switch(t.index){case 0:u(o.features,inputValues[5]),p(),a=[-2,-1,0,1,2,3],e=d3.select("#c-svg-03-legend").append("svg").attr("width",y).attr("height",70),(r=e.selectAll(".legend").data(d.range()).enter().append("g").attr("class","legend")).append("rect").attr("x",function(t,e){return y/2-100+30*e}).attr("y",40).attr("width",23).attr("height",12).style("stroke","black").style("stroke-width",.1).style("fill",function(t){return t}),r.append("text").attr("fill","#f0f0f0").attr("x",function(t,e){return y/2-100+30+30*e}).attr("dx",-5).attr("y",60).attr("dy","0.5em").attr("text-anchor","middle").text(function(t,e){return a[e]}),e.append("text").attr("x",y/2).attr("y",x/2+5).attr("text-anchor","middle").attr("fill","#f0f0f0").text("Taux d'évolution de la population due au solde"),e.append("text").attr("x",y/2).attr("y",x/2+20).attr("text-anchor","middle").attr("fill","#f0f0f0").text("migratoire apparent (moyenne annuelle, en %) "),m.style.display="inline",g[0].style.opacity="1"}var a,e,r}).onStepExit(function(t){switch(t.index){case 0:d3.select("#c-svg-03").selectAll(".label-change2").remove(),d3.select("#c-svg-03").selectAll(".rw").remove(),d3.select("#c-svg-03").selectAll(".extra").remove(),d3.select("#c-svg-03-legend").selectAll("*").remove(),m.style.display="none",g[0].style.opacity="0.4"}})})}input03.oninput=function(){output03Bullet.innerHTML=inputValues[this.value]},window.addEventListener("load",function(){"none"==getComputedStyle(document.querySelector(".c-graphic-min")).display&&graph03()});var inputValues2=["1968-1975","1975-1982","1982-1990","1990-1999","1999-2009","2009-2014"],input04=document.querySelector("#input-04"),output04=document.querySelector("#c-output-04"),output04Bullet=document.querySelector("#output-04-bullet");input04.oninput=function(){output04Bullet.innerHTML=inputValues2[this.value]},input04.oninput();var deplaceOutputBullet2=function(){var t=input04.value/input04.max;output04Bullet.style.left=t*input04.getBoundingClientRect().width*.9221018907+"px"};function graph4(){var a=document.querySelector("#help-button4"),r=document.querySelectorAll(".break-section3");scrollama().setup({container:".scroll",graphic:".scroll-graphic",text:".scroll-text",step:".break-section3",debug:!1,offset:.6}).onStepEnter(function(t){var e=document.querySelector("#c-04-section3 .svg-title");switch(t.index){case 1:e.style.display="block",function(){var s=60,u=20,f=70,m=20,g=document.querySelector(".niv2 p").clientWidth,x=d3.select("#c-svg-04").append("svg").attr("height",400).attr("width",g);d3.formatDefaultLocale({decimal:",",thousands:" ",grouping:[3]});var v=d3.format(".2n"),y=d3.format(",.0f"),h=d3.format("");d3.csv("data/csv/data-04.csv").then(function(c){c.forEach(function(t){t.pop_sm_68_75=+t.pop_sm_68_75,t.pop_sm_75_82=+t.pop_sm_75_82,t.pop_sm_82_90=+t.pop_sm_82_90,t.pop_sm_90_99=+t.pop_sm_90_99,t.pop_sm_99_09=+t.pop_sm_99_09,t.pop_sm_09_14=+t.pop_sm_09_14,t.tx_sm_68_75=+t.tx_sm_68_75,t.tx_sm_75_82=+t.tx_sm_75_82,t.tx_sm_82_90=+t.tx_sm_82_90,t.tx_sm_90_99=+t.tx_sm_90_99,t.tx_sm_99_09=+t.tx_sm_99_09,t.tx_sm_09_14=+t.tx_sm_09_14});var i=d3.scaleOrdinal().domain(["01","02","03","04","11","24","27","28","32","44","52","53","75","76","84","93","94"]).range(["#faa61a","#fec641","#bb529e","#b71f2b","#ccecfa","#d8c470","#a7d48c","#f8d6c7","#bcbcbc","#f9f49b","#eec0d9","#abdfeb","#cfe295","#f79868","#9fc9eb","#f9b132","#a9d9bc"]),t=c.columns.slice(8,14),e=d3.max(c,function(e){return d3.max(t,function(t){return e[t]})}),a=d3.min(c,function(e){return d3.min(t,function(t){return e[t]})}),r=c.columns.slice(2,8),d=d3.max(c,function(e){return d3.max(r,function(t){return e[t]})}),p=d3.scaleLinear().domain([a,e]).range([m,g-u]).nice(),n=d3.axisBottom(p).tickSizeOuter(0).tickFormat(function(t){return h(t)+" %"});function l(e,a,t){x.append("text").attr("class","label-change label-change2").attr("x",90).attr("y",25).attr("fill","#f0f0f0").text(t);for(var r=d3.forceSimulation(c).force("x",d3.forceX(function(t){return p(t[e])}).strength(1)).force("y",d3.forceY(200-f/2)).force("collide",d3.forceCollide().radius(function(t){return 50*Math.sqrt(t[a]/d)})).stop(),n=0;n<c.length;n++)r.tick();var l=x.selectAll(".circles").data(c,function(t){return t.codgeo});l.exit().transition().duration(200).attr("cx",0).attr("cy",200-f/2).remove();var o=l.enter().append("g").attr("id",function(t){return"g-"+t.codgeo});o.append("circle").attr("class","circles").attr("r",1).attr("cx",function(t){return t.x}).attr("cy",function(t){return t.y}).attr("fill",function(t){return i(t.codgeo)}).merge(l).transition().duration(1500).attr("cx",function(t){return t.x}).attr("cy",function(t){return t.y}).attr("r",function(t){return 50*Math.sqrt(t[a]/d)});var s=d3.select("body").append("div").attr("class","my-popup");o.on("mouseover",function(t){s.transition().duration(50).style("left",d3.event.pageX-20+"px").style("top",d3.event.pageY-10+"px").style("opacity",1).style("text-align","left"),s.html("\n\t\t\t\t\t\t\t\t<div><strong>".concat(t.libgeo,"</strong></div>\n\t\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t\t<div>Solde migratoire annuel moyen</div>\n\t\t\t\t\t\t\t\t\t<span>").concat(y(t[a])," </span>\n\t\t\t\t\t\t\t\t\t<div>Taux d'évolution de la population</div>\n\t\t\t\t\t\t\t\t\t<span>").concat(v(t[e])," % </span>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t")),d3.select(this).attr("fill-opacity",.7)}).on("mouseout",function(t){s.transition().duration(100).style("opacity",0),d3.select(this).attr("fill-opacity",1)})}x.append("text").attr("class","extra label-change").attr("x",20).attr("y",25).attr("fill","#f0f0f0").text("Période"),x.append("line").attr("class","extra line-extra").attr("x1",m).attr("y1",5).attr("x2",180).attr("y2",5).attr("stroke","#fff"),x.append("line").attr("class","extra line-extra").attr("x1",m).attr("y1",35).attr("x2",180).attr("y2",35).attr("stroke","#fff"),x.append("g").attr("class","axis x_axis").attr("transform","translate(0,".concat(400-f,")")).call(n),x.select(".x_axis").selectAll("text").attr("y",10),x.append("line").attr("x1",p(0)).attr("x2",p(0)).attr("y1",s).attr("y2",400-f).attr("stroke","#fff").attr("stroke-width",2);var o=x.append("g").attr("class","circle-legend");o.append("text").attr("class","label-circle").attr("x",6*g/7-20).attr("y",25).attr("fill","#f0f0f0").text("Solde migratoire annuel moyen"),o.append("circle").attr("cx",6*g/7-20).attr("cy",s+40).attr("r",50*Math.sqrt(d/d)),o.append("circle").attr("cx",6*g/7-20).attr("cy",s+40+50*Math.sqrt(25e3/d)/2).attr("r",50*Math.sqrt(25e3/d)),o.append("circle").attr("cx",6*g/7-20).attr("cy",s+40+50*Math.sqrt(25e3/d)).attr("r",50*Math.sqrt(5e3/d)),o.append("text").attr("class","label-circle").attr("x",6*g/7-20).attr("y",s/2+15).text(y(d)),o.append("text").attr("class","label-circle").attr("x",6*g/7-20).attr("y",s/2+50*Math.sqrt(25e3/d)+15).text(y(5e3)),o.append("text").attr("class","label-circle").attr("x",6*g/7-20).attr("y",s/2+2*Math.sqrt(25e3/d)*50+15).text(y(1e3)),input04.addEventListener("input",function(t){switch(deplaceOutputBullet2(),t.target.value){case"0":d3.selectAll(".label-change2").remove(),l("tx_sm_68_75","pop_sm_68_75",inputValues2[0]);break;case"1":d3.selectAll(".label-change2").remove(),l("tx_sm_75_82","pop_sm_75_82",inputValues2[1]);break;case"2":d3.selectAll(".label-change2").remove(),l("tx_sm_82_90","pop_sm_82_90",inputValues2[2]);break;case"3":d3.selectAll(".label-change2").remove(),l("tx_sm_90_99","pop_sm_90_99",inputValues2[3]);break;case"4":d3.selectAll(".label-change2").remove(),l("tx_sm_99_09","pop_sm_99_09",inputValues2[4]);break;case"5":d3.selectAll(".label-change2").remove(),l("tx_sm_09_14","pop_sm_09_14",inputValues2[5])}}),l("tx_sm_09_14","pop_sm_09_14",inputValues2[5]),deplaceOutputBullet2()})}(),a.style.display="inline",r[1].style.opacity="1"}}).onStepExit(function(t){var e=document.querySelector("#c-04-section3 .svg-title");switch(t.index){case 1:d3.select("#c-svg-04").selectAll("*").remove(),e.style.display="none",a.style.display="none",r[1].style.opacity="0.4"}})}function graph5(){var a=document.querySelector("#help-button5"),t=scrollama(),r=document.querySelectorAll(".break-section3");t.setup({container:".scroll",graphic:".scroll-graphic",text:".scroll-text",step:".break-section3",debug:!1,offset:.6}).onStepEnter(function(t){var e=document.querySelector("#c-05-section3 .svg-title");switch(t.index){case 2:!function(){var m=document.querySelector(".niv2 p").clientWidth,g=d3.select("#c-svg-05").append("svg").attr("height",400).attr("width",m);d3.formatDefaultLocale({decimal:",",thousands:" ",grouping:[3]});var x=d3.format(".2n");Promise.all([d3.json("data/map/dep.json"),d3.json("data/map/dep_reg.json"),d3.csv("data/csv/data-05.csv")]).then(function(t){for(var e=topojson.feature(t[0],t[0].objects.dep_gen_wgs84),a=topojson.feature(t[1],t[1].objects.dep_reg_gen_wgs84),r=0;r<t[2].length;r++)for(var n=t[2][r].coddep,l=0;l<e.features.length;l++)if(n===e.features[l].properties.coddep){e.features[l].properties.tx_19992009=t[2][r].tx_19992009,e.features[l].properties.tx_20092014=t[2][r].tx_20092014,e.features[l].properties.quali=t[2][r].quali;break}var o=d3.scaleOrdinal().domain(["0_0","0_1","0_2","1_0","1_1","1_2","2_0","2_1","2_2"]).range(["#045364","#1a5230","#ad6116","#26a199","#39a065","#e89e3f","#aedbde","#b0d8bd","#fad8af"]),s=d3.geoConicConformal().fitSize([m,400],e),c=d3.geoPath().projection(s),i=g.append("g"),d=i.append("g").attr("class","c-dep").selectAll(".dep").data(e.features).join("path").attr("d",c).attr("class","dep").attr("stroke","white").attr("stroke-width",.1).attr("fill",function(t){return o(t.properties.quali)});i.append("g").attr("class","c-reg").append("path").datum(a).attr("d",c).attr("class","region"),g.call(d3.zoom().scaleExtent([1,6]).translateExtent([[0,0],[m,400]]).on("zoom",function(){i.attr("transform",d3.event.transform)}).on("start",function(){d.on("mouseover",null)}).on("end",function(){d.on("mouseover",function(t){f.transition().duration(50).style("left",d3.event.pageX-20+"px").style("top",d3.event.pageY-100+"px").style("opacity",1).style("text-align","left"),f.html("\n\t\t\t\t\t\t\t\t<div><strong>".concat(t.properties.libdep,"</strong></div>\n\t\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t\t<div>Croissance migratoire</div>\n\t\t\t\t\t\t\t\t\t<em>1999-2009</em> : <span>").concat(x(t.properties.tx_19992009)," % </span>\n\t\t\t\t\t\t\t\t\t<br>\n\t\t\t\t\t\t\t\t\t<em>2009-2014</em> : <span>").concat(x(t.properties.tx_20092014)," % </span>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t")),d3.select(this).attr("fill-opacity",.7)})}));var p=["Décroissance migratoire sur 1999-2009 et sur 2009-2014","Décroissance migratoire sur 1999-2009 et croissance faible sur 2009-2014","Décroissance migratoire sur 1999-2009 et croissance forte sur 2009-2014","Croissance faible sur 1999-2009 et décroissance sur 2009-2014","Croissance faible sur 1999-2009 et sur 2009-2014","Croissance faible sur 1999-2009 et croissance forte sur 2009-2014","Croissance forte sur 1999-2009 et décroissance sur 2009-2014","Croissance forte sur 1999-2009 et croissance faible sur 2009-2014","Croissance forte sur 1999-2009 et sur 2009-2014"];d3.select("#c-svg-05-legend").selectAll("*").remove();var u=d3.select("#c-svg-05-legend").append("svg").attr("width",m).attr("height",185).selectAll(".legend").data(o.range()).enter().append("g").attr("class","legend");u.append("rect").attr("x",m/3-100).attr("y",function(t,e){return 20*e+10}).attr("width",23).attr("height",12).style("stroke","black").style("stroke-width",.1).style("fill",function(t){return t}),u.append("text").attr("fill","#f0f0f0").attr("x",m/3+30-100).attr("y",function(t,e){return 15+20*e}).attr("dy","0.5em").text(function(t,e){return p[e]});var f=d3.select("body").append("div").attr("class","my-popup");d.on("mouseover",function(t){f.transition().duration(50).style("left",d3.event.pageX-20+"px").style("top",d3.event.pageY-100+"px").style("opacity",1).style("text-align","left"),f.html("\n\t\t\t\t\t\t\t<div><strong>".concat(t.properties.libdep,"</strong></div>\n\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t<div>Évolution migratoire</div>\n\t\t\t\t\t\t\t\t<em>1999-2009</em> : <span>").concat(x(t.properties.tx_19992009)," % </span>\n\t\t\t\t\t\t\t\t<br>\n\t\t\t\t\t\t\t\t<em>2009-2014</em> : <span>").concat(x(t.properties.tx_20092014)," % </span>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t")),d3.select(this).attr("fill-opacity",.7)}).on("mouseout",function(t){f.transition().duration(100).style("opacity",0),d3.select(this).attr("fill-opacity",1)})})}(),e.style.display="block",a.style.display="inline",r[2].style.opacity="1"}}).onStepExit(function(t){var e=document.querySelector("#c-05-section3 .svg-title");switch(t.index){case 0:case 1:d3.select("#c-svg-05-legend").selectAll("*").remove();break;case 2:d3.select("#c-svg-05").selectAll("*").remove(),d3.select("#c-svg-05-legend").selectAll("*").remove(),e.style.display="none",a.style.display="none",r[2].style.opacity="0.4"}})}function graph6(){var k=35,w=20,A=30,S=50,M=document.querySelector(".niv2 p").clientWidth,q=d3.select("#c-svg-06").append("svg").attr("height",400).attr("width",M);d3.formatDefaultLocale({decimal:",",thousands:" ",grouping:[3]});var j=d3.format("");d3.csv("data/csv/data-06.csv").then(function(t){t.forEach(function(t){t[111]=+t[111],t[112]=+t[112],t[120]=+t[120],t[211]=+t[211],t[212]=+t[212],t[221]=+t[221],t[222]=+t[222],t[300]=+t[300],t[400]=+t[400]});var a=t.columns.slice(1,10),e=d3.max(t,function(e){return d3.max(a,function(t){return e[t]})}),r=d3.min(t,function(e){return d3.min(a,function(t){return e[t]})}),n=d3.scaleLinear().domain(d3.extent(t,function(t){return t.year})).range([S,M-w]),l=d3.scaleLinear().domain([r,e]).nice().range([400-A,k]),o=d3.axisBottom(n).tickSizeOuter(0),s=d3.axisLeft(l).ticks(5).tickSizeOuter(0).tickFormat(function(t){return j(t)+" %"});q.append("g").attr("class","axis x_axis").attr("transform","translate(0,".concat(400-A,")")).call(o),q.select(".x_axis").selectAll("text").attr("y",10),q.append("g").attr("class","axis y_axis").attr("transform","translate(".concat(S,",0)")).call(s),q.select(".y_axis").selectAll("text").attr("x",-10).attr("dy",3);var c=d3.line().x(function(t){return n(t.year)}).y(function(t){return l(t[111])}).curve(d3.curveMonotoneX),i=d3.line().x(function(t){return n(t.year)}).y(function(t){return l(t[112])}).curve(d3.curveMonotoneX),d=d3.line().x(function(t){return n(t.year)}).y(function(t){return l(t[120])}).curve(d3.curveMonotoneX),p=d3.line().x(function(t){return n(t.year)}).y(function(t){return l(t[211])}).curve(d3.curveMonotoneX),u=d3.line().x(function(t){return n(t.year)}).y(function(t){return l(t[212])}).curve(d3.curveMonotoneX),f=d3.line().x(function(t){return n(t.year)}).y(function(t){return l(t[221])}).curve(d3.curveMonotoneX),m=d3.line().x(function(t){return n(t.year)}).y(function(t){return l(t[222])}).curve(d3.curveMonotoneX),g=d3.line().x(function(t){return n(t.year)}).y(function(t){return l(t[300])}).curve(d3.curveMonotoneX),x=d3.line().x(function(t){return n(t.year)}).y(function(t){return l(t[400])}).curve(d3.curveMonotoneX);q.append("line").attr("x1",S).attr("x2",M-w).attr("y1",l(0)).attr("y2",l(0)).attr("stroke","#fff").attr("stroke-width",2),q.append("path").datum(t).attr("class","lineZAU").attr("fill","none").attr("stroke-width",2).attr("d",c),q.append("path").datum(t).attr("class","lineZAU").attr("fill","none").attr("stroke-width",2).attr("d",i),q.append("path").datum(t).attr("class","lineZAU").attr("fill","none").attr("stroke-width",2).attr("d",d),q.append("path").datum(t).attr("class","lineZAU").attr("fill","none").attr("stroke-width",2).attr("d",p),q.append("path").datum(t).attr("class","lineZAU").attr("fill","none").attr("stroke-width",2).attr("d",u),q.append("path").datum(t).attr("class","lineZAU").attr("fill","none").attr("stroke-width",2).attr("d",f),q.append("path").datum(t).attr("class","lineZAU").attr("fill","none").attr("stroke-width",2).attr("d",m),q.append("path").datum(t).attr("class","lineZAU").attr("fill","none").attr("stroke-width",2).attr("d",g),q.append("path").datum(t).attr("class","lineZAU").attr("fill","none").attr("stroke-width",2).attr("d",x);var v=["#c90c10","#f49829","#f9d333","#a31876","#ca75ad","#0a9ba2","#8acdd2","#ccc1da","#f2f4ee"],y=document.querySelectorAll(".lineZAU");Array.from(y).forEach(function(t,e){t.setAttribute("stroke",v[e])});var h=d3.select("body").append("div").attr("class","my-popup");d3.selectAll(".lineZAU").on("mouseover",function(t,e){switch(h.transition().duration(50).style("left",d3.event.pageX-20+"px").style("top",d3.event.pageY-30+"px").style("opacity",1).style("text-align","left"),e){case 0:h.html("\n\t\t\t\t\t\t\t<div><strong>Grands pôles</strong></div>\n\t\t\t\t\t\t\t");break;case 1:h.html("\n\t\t\t\t\t\t\t<div><strong>Couronnes de grands pôles</strong></div>\n\t\t\t\t\t\t\t");break;case 2:h.html("\n\t\t\t\t\t\t\t<div><strong>Communes multipolarisées des grandes aires urbaines</strong></div>\n\t\t\t\t\t\t\t");break;case 3:h.html("\n\t\t\t\t\t\t\t<div><strong>Pôles moyens</strong></div>\n\t\t\t\t\t\t\t");break;case 4:h.html("\n\t\t\t\t\t\t\t<div><strong>Couronnes des pôles moyens</strong></div>\n\t\t\t\t\t\t\t");break;case 5:h.html("\n\t\t\t\t\t\t\t<div><strong>Petits pôles</strong></div>\n\t\t\t\t\t\t\t");break;case 6:h.html("\n\t\t\t\t\t\t\t<div><strong>Couronnes des petits pôles</strong></div>\n\t\t\t\t\t\t\t");break;case 7:h.html("\n\t\t\t\t\t\t\t<div><strong>Autres communes multipolarisées</strong></div>\n\t\t\t\t\t\t\t");break;case 8:h.html("\n\t\t\t\t\t\t\t<div><strong>Communes isolées, hors influence des pôles</strong></div>\n\t\t\t\t\t\t\t")}d3.select(this).attr("fill-opacity",.7)}).on("mouseout",function(t){h.transition().duration(100).style("opacity",0),d3.select(this).attr("fill-opacity",1)});var _=["Grands pôles","Couronnes de grands pôles","Communes multipolarisées des grandes aires urbaines","Pôles moyens","Couronnes des pôles moyens","Petits pôles","Couronnes des petits pôles","Autres communes multipolarisées","Communes isolées, hors influence des pôles"],b=d3.select("#c-svg-06-legend").append("svg").attr("width",M).attr("height",180).selectAll(".legend").data(v).enter().append("g").attr("class","legend");b.append("rect").attr("x",10+S).attr("y",function(t,e){return 20*e+5}).attr("width",23).attr("height",12).style("stroke","black").style("stroke-width",.1).style("fill",function(t){return t}),b.append("text").attr("fill","#f0f0f0").attr("x",40+S).attr("y",function(t,e){return 10+20*e}).attr("dy","0.5em").text(function(t,e){return _[e]})})}window.addEventListener("resize",function(){deplaceOutputBullet2()}),window.addEventListener("load",function(){"none"==getComputedStyle(document.querySelector(".c-graphic-min")).display&&graph4()}),window.addEventListener("load",function(){"none"==getComputedStyle(document.querySelector(".c-graphic-min")).display&&graph5()}),window.addEventListener("load",function(){"none"==getComputedStyle(document.querySelector(".c-graphic-min")).display&&graph6()});var inputValues3=["1968-1975","1975-1982","1982-1990","1990-1999","1999-2009","2009-2014"],input07=document.querySelector("#input-07"),output07=document.querySelector("#c-output-07"),output07Bullet=document.querySelector("#output-07-bullet");input07.oninput=function(){output07Bullet.innerHTML=inputValues3[this.value]},input07.oninput();var deplaceOutputBullet3=function(){var t=input07.value/input07.max;output07Bullet.style.left=t*input07.getBoundingClientRect().width*.9221018907+"px"};function graph7(){var b=110,k=40,w=60,A=50,S=document.querySelector(".niv2 p").clientWidth,M=d3.select("#c-svg-07").append("svg").attr("height",500).attr("width",S);d3.formatDefaultLocale({decimal:",",thousands:" ",grouping:[3]});var q=d3.format(".2n"),j=(d3.format(",.0f"),d3.format(""));d3.csv("data/csv/data-07.csv").then(function(d){d.forEach(function(t,e){for(var a in t)+t[a]==+t[a]&&(t[a]=+t[a])});var t=d.columns.slice(14,20),a=d.columns.slice(20,28),r=d.columns.slice(2,8),n=d.columns.slice(8,14),e=d3.max(d,function(e){return d3.max(t,function(t){return e[t]})}),l=d3.min(d,function(e){return d3.min(t,function(t){return e[t]})}),o=d3.max(d,function(e){return d3.max(a,function(t){return e[t]})}),s=d3.min(d,function(e){return d3.min(a,function(t){return e[t]})}),p=d3.max(d,function(e){return d3.max(r,function(t){return e[t]})}),c=d3.min(d,function(e){return d3.min(n,function(t){return e[t]})}),i=d3.max(d,function(e){return d3.max(n,function(t){return e[t]})}),u=d3.scaleLinear().domain([l,e]).range([A,S-k]).nice(),f=d3.scaleLinear().domain([s,o]).range([500-w,b]).nice(),m=d3.axisBottom(u).ticks(5).tickSizeOuter(0).tickFormat(function(t){return j(t)+" %"}),g=d3.axisLeft(f).ticks(5).tickSizeOuter(0).tickFormat(function(t){return j(t)+" %"});M.append("g").attr("class","axis x_axis").attr("transform","translate(0,".concat(500-w,")")).call(m),M.select(".x_axis").selectAll("text").attr("y",10),M.append("g").attr("class","axis y_axis").attr("transform","translate(".concat(A,",0)")).call(g),M.append("line").attr("x1",u(0)).attr("x2",u(0)).attr("y1",b).attr("y2",500-w).attr("stroke","#fff").attr("stroke-width",2),M.append("line").attr("x1",A).attr("x2",S-k).attr("y1",f(0)).attr("y2",f(0)).attr("stroke","#fff").attr("stroke-width",2);var x=d3.scaleLinear().domain([c,-.25,0,.5,1,i]).range(["#c8c6c6","#dbecdb","#b79bc9","#7959a2","#5d36bc"]),v=d3.scaleOrdinal().domain(111,112,120,211,212,221,222,300,400).range(["#c90c10","#f49829","#f9d333","#a31876","#ca75ad","#0a9ba2","#8acdd2","#ccc1da","#f2f4ee"]);M.append("text").attr("fill","#f0f0f0").attr("class","extra label-change").attr("x",A).attr("y",25).text("Période"),M.append("line").attr("class","extra line-extra").attr("x1",A).attr("y1",5).attr("x2",180+A).attr("y2",5).attr("stroke","#fff"),M.append("line").attr("class","extra line-extra").attr("x1",A).attr("y1",35).attr("x2",180+A).attr("y2",35).attr("stroke","#fff"),M.append("text").attr("fill","#f0f0f0").attr("class","label").attr("y",b/2+25).attr("x",A/2).style("text-anchor","start").text("Taux d'évolution de la population"),M.append("text").attr("fill","#f0f0f0").attr("class","label").attr("y",b/2+40).attr("x",A/2).style("text-anchor","start").text("due au solde migratoire apparent"),M.append("text").attr("class","label").attr("transform","translate("+(S-k)+" ,"+(500-w/3)+")").style("text-anchor","end").attr("fill","#f0f0f0").text("Taux d'évolution de la population"),M.append("text").attr("class","label").attr("transform","translate("+(S-k)+" ,"+(500-w/3+15)+")").style("text-anchor","end").attr("fill","#f0f0f0").text("due au solde naturel");var y=M.selectAll(".legend").data(x.range()).enter().append("g").attr("class","legend");function h(e,a,r,n,t){M.append("text").attr("fill","#f0f0f0").attr("class","label-change label-change2").attr("x",70+A).attr("y",25).text(t);for(var l=d3.forceSimulation(d).force("x",d3.forceX(function(t){return u(t[r])}).strength(1)).force("y",d3.forceY(function(t){return f(t[n])}).strength(1)).stop(),o=0;o<d.length;o++)l.tick();var s=M.selectAll(".circles").data(d,function(t){return t.codgeo});s.exit().transition().duration(1e3).attr("cx",0).attr("cy",250-w/2).remove();var c=s.enter().append("g").attr("id",function(t){return"g-"+t.codgeo});c.append("circle").attr("class","circles").attr("r",1).attr("cx",function(t){return t.x}).attr("cy",function(t){return t.y}).attr("stroke",function(t){return v(t.codgeo)}).attr("stroke-width",3).merge(s).transition().duration(1500).attr("fill",function(t){return x(t[a])}).attr("cx",function(t){return t.x}).attr("cy",function(t){return t.y}).attr("r",function(t){return 50*Math.sqrt(t[e]/p)});var i=d3.select("body").append("div").attr("class","my-popup");c.on("mouseover",function(t){i.transition().duration(50).style("left",d3.event.pageX-20+"px").style("top",d3.event.pageY-10+"px").style("opacity",1).style("text-align","left"),i.html("\n\t\t\t\t\t\t\t<div><strong>".concat(t.libgeo,"</strong></div>\n\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t<div>Taux d'évolution de la population</div>\n\t\t\t\t\t\t\t\t<em>Total</em> : <span>").concat(q(t[a])," % </span>\n\t\t\t\t\t\t\t\t<br>\n\t\t\t\t\t\t\t\t<em>Due au solde naturel</em> : <span>").concat(q(t[r])," % </span>\n\t\t\t\t\t\t\t\t<br>\n\t\t\t\t\t\t\t\t<em>Due au solde migratoire</em> : <span>").concat(q(t[n])," % </span>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t")),d3.select(this).attr("fill-opacity",.7)}).on("mouseout",function(t){i.transition().duration(100).style("opacity",0),d3.select(this).attr("fill-opacity",1)})}y.append("rect").attr("x",function(t,e){return 3*S/7+30*e}).attr("y",b/2+20).attr("width",23).attr("height",12).style("stroke","black").style("stroke-width",.1).style("fill",function(t){return t}),y.append("text").attr("x",function(t,e){return 3*S/7+30*e}).attr("dx",-5).attr("y",b/2+40).attr("dy","0.5em").attr("text-anchor","middle").attr("fill","#f0f0f0").text(function(t,e){return q(x.domain()[e])}),M.append("text").attr("x",3*S/7+150).attr("dx",-5).attr("y",b/2+40).attr("dy","0.5em").attr("text-anchor","middle").attr("fill","#f0f0f0").text(q(x.domain()[5])),M.append("text").attr("x",3*S/7-40).attr("y",b/2+5).attr("text-anchor","start").attr("fill","#f0f0f0").text("Taux de croissance annuel moyen (%)");var _=M.append("g").attr("class","circle-legend");_.append("text").attr("class","label-circle").attr("x",6*S/7).attr("y",20).attr("fill","#f0f0f0").text("Population"),_.append("circle").attr("cx",6*S/7).attr("cy",b/2+45).attr("r",50*Math.sqrt(p/p)),_.append("circle").attr("cx",6*S/7).attr("cy",b/2+40+50*Math.sqrt(2e7/p)/2).attr("r",50*Math.sqrt(2e7/p)),_.append("circle").attr("cx",6*S/7).attr("cy",b/2+40+50*Math.sqrt(2e7/p)).attr("r",50*Math.sqrt(5e6/p)),_.append("text").attr("class","label-circle").attr("x",6*S/7).attr("y",b/3+5).text("39 M"),_.append("text").attr("class","label-circle").attr("x",6*S/7).attr("y",b/2+50*Math.sqrt(2e7/p)/2-3).text("5 M"),_.append("text").attr("class","label-circle").attr("x",6*S/7).attr("y",b/2+15+50*Math.sqrt(2e7/p)).text("1 M"),h("pop_2014","tx_pop_2014","tx_pop_sn_2014","tx_pop_sm_2014",inputValues3[5]),deplaceOutputBullet3(),input07.addEventListener("input",function(t){switch(deplaceOutputBullet3(),t.target.value){case"0":d3.select("#c-svg-07").selectAll(".label-change2").remove(),h("pop_1975","tx_pop_1975","tx_pop_sn_1975","tx_pop_sm_1975",inputValues3[0]);break;case"1":d3.select("#c-svg-07").selectAll(".label-change2").remove(),h("pop_1982","tx_pop_1982","tx_pop_sn_1982","tx_pop_sm_1982",inputValues3[1]);break;case"2":d3.select("#c-svg-07").selectAll(".label-change2").remove(),h("pop_1990","tx_pop_1990","tx_pop_sn_1990","tx_pop_sm_1990",inputValues3[2]);break;case"3":d3.select("#c-svg-07").selectAll(".label-change2").remove(),h("pop_1999","tx_pop_1999","tx_pop_sn_1999","tx_pop_sm_1999",inputValues3[3]);break;case"4":d3.select("#c-svg-07").selectAll(".label-change2").remove(),h("pop_2009","tx_pop_2009","tx_pop_sn_2009","tx_pop_sm_2009",inputValues3[4]);break;case"5":d3.select("#c-svg-07").selectAll(".label-change2").remove(),h("pop_2014","tx_pop_2014","tx_pop_sn_2014","tx_pop_sm_2014",inputValues3[5])}})})}function graph8(){var n=document.querySelector("#object-08");n.addEventListener("load",function(){var t=document.querySelector(".niv2 p").clientWidth,e=n.getSVGDocument().querySelector("#svg-08-section6"),a=n.getSVGDocument().querySelectorAll(".csp-flow");n.getSVGDocument().querySelector("#carte_complete");function r(t){for(var e=0;e<a.length;e++)t!=e?a[e].setAttribute("opacity",0):a[e].setAttribute("opacity",1)}e.setAttribute("width",t),e.setAttribute("height",440),d3.select("#toolbar-08").selectAll(".button").on("click",function(){d3.selectAll(".button").classed("active",!1);var t=d3.select(this);switch(t.classed("active",!0),t.attr("id")){case"csp-all":r(0);break;case"csp-cadres":r(1);break;case"csp-retraites":r(2);break;case"csp-etudiants":r(3);break;case"csp-ouvriers":r(4)}})});var e=document.querySelector("#c-svg-08").clientWidth,a=d3.select("#c-svg-08-legend").append("svg").attr("width",e).attr("height",90);function r(){var t=a.append("g").attr("class","all-flow");t.append("rect").attr("x",30+e/3).attr("y",25).attr("width",7.2).attr("height",40).attr("fill","#fff"),t.append("rect").attr("x",80+e/3).attr("y",25).attr("width",2.55).attr("height",40).attr("fill","#fff"),t.append("rect").attr("x",130+e/3).attr("y",25).attr("width",1.79).attr("height",40).attr("fill","#fff"),t.append("rect").attr("x",180+e/3).attr("y",25).attr("width",1.09).attr("height",40).attr("fill","#fff"),t.append("text").attr("fill","#f0f0f0").attr("x",30+e/3).attr("y",85).text("40 000"),t.append("text").attr("fill","#f0f0f0").attr("x",80+e/3).attr("y",85).text("5 000"),t.append("text").attr("fill","#f0f0f0").attr("x",130+e/3).attr("y",85).text("2 500"),t.append("text").attr("fill","#f0f0f0").attr("x",180+e/3).attr("y",85).text("1 000")}function l(){var t=a.append("g").attr("class","by-flow");t.append("rect").attr("x",30+e/3).attr("y",25).attr("width",5.33).attr("height",40).attr("fill","#fff"),t.append("rect").attr("x",80+e/3).attr("y",25).attr("width",3.8).attr("height",40).attr("fill","#fff"),t.append("rect").attr("x",130+e/3).attr("y",25).attr("width",2.71).attr("height",40).attr("fill","#fff"),t.append("rect").attr("x",180+e/3).attr("y",25).attr("width",1.72).attr("height",40).attr("fill","#fff"),t.append("text").attr("fill","#f0f0f0").attr("x",30+e/3).attr("y",85).text("10 000"),t.append("text").attr("fill","#f0f0f0").attr("x",80+e/3).attr("y",85).text("5 000"),t.append("text").attr("fill","#f0f0f0").attr("x",130+e/3).attr("y",85).text("2 000"),t.append("text").attr("fill","#f0f0f0").attr("x",180+e/3).attr("y",85).text("1 000")}r(),a.append("g").attr("class","legend-text").append("text").attr("x",e/2).attr("y",10).attr("text-anchor","middle").attr("fill","#f0f0f0").text("Nombre d'individus"),Array.from(document.querySelectorAll(".button-csp")).forEach(function(e,t){e.addEventListener("click",function(t){switch(e.id){case"csp-all":d3.select("#c-svg-08-legend").selectAll(".all-flow").remove(),d3.select("#c-svg-08-legend").selectAll(".by-flow").remove(),r();break;case"csp-cadres":case"csp-retraites":case"csp-etudiants":case"csp-ouvriers":d3.select("#c-svg-08-legend").selectAll(".all-flow").remove(),d3.select("#c-svg-08-legend").selectAll(".by-flow").remove(),l()}})})}function graph10(){var x=20,v=document.querySelector(".niv2 p").clientWidth,y=d3.select("#c-svg-10").append("svg").attr("height",400).attr("width",v);d3.formatDefaultLocale({decimal:",",thousands:" ",grouping:[3]}),Promise.all([d3.json("data/map/epci.json"),d3.json("data/map/epci_reg.json"),d3.csv("data/csv/data-10.csv")]).then(function(t){for(var e=topojson.feature(t[0],t[0].objects.epci_gen),a=topojson.feature(t[1],t[1].objects.epci_reg_gen),r=0;r<t[2].length;r++)for(var n=t[2][r].codepci,l=0;l<e.features.length;l++){if(n===e.features[l].properties.codepci){e.features[l].properties.clust=t[2][r].clust,e.features[l].properties.cat=t[2][r].cat;break}}var o=d3.scaleOrdinal().domain(["1","2","3","4","5","6"]).range(["#53995c","#7cc18b","#e8e774","#eec05d","#c4431d","#e08343"]),s=d3.geoConicConformal().fitSize([v,400],e),c=d3.geoPath().projection(s),i=y.append("g"),d=i.append("g").attr("class","c-epci").selectAll(".epci").data(e.features).join("path").attr("d",c).attr("class","epci").attr("stroke","white").attr("stroke-width",.1).attr("fill",function(t){return o(t.properties.clust)});i.append("g").attr("class","c-reg").append("path").datum(a).attr("d",c).attr("class","region");function p(){d3.select("#c-svg-10-legend").selectAll("*").remove();var a=["Retraités","Profil diversifié, plutôt âgé","Ouvriers et jeunes enfants","Employés et ouvriers","Jeunes adultes, étudiants et cadres","Trentenaires, cadres et prof. int."],t=d3.select("#c-svg-10-legend").append("svg").attr("width",v).attr("height",125).selectAll(".legend").data(o.range()).enter().append("g").attr("class","legend");t.append("rect").attr("x",v/3+30).attr("y",function(t,e){return 20*e+10}).attr("width",23).attr("height",12).style("stroke","black").style("stroke-width",.1).style("fill",function(t){return t}),t.append("text").attr("fill","#f0f0f0").attr("x",v/3+60).attr("y",function(t,e){return 15+20*e}).attr("dy","0.5em").text(function(t,e){return a[e]})}y.append("line").attr("class","extra line-extra").attr("x1",x).attr("y1",5).attr("x2",180+x).attr("y2",5).attr("stroke","#fff"),y.append("line").attr("class","extra line-extra").attr("x1",x).attr("y1",35).attr("x2",180+x).attr("y2",35).attr("stroke","#fff"),p(),y.call(d3.zoom().scaleExtent([1,6]).translateExtent([[0,0],[v,400]]).on("zoom",function(){i.attr("transform",d3.event.transform)}).on("start",function(){d.on("mouseover",null)}).on("end",function(){d.on("mouseover",function(t){u.transition().duration(50).style("left",d3.event.pageX-20+"px").style("top",d3.event.pageY-30+"px").style("opacity",1).style("text-align","left"),u.html("\n\t\t\t\t\t\t\t<div><strong>".concat(t.properties.libepci,"</strong></div>\n\t\t\t\t\t\t\t")),d3.select(this).attr("fill-opacity",.7)})}));var u=d3.select("body").append("div").attr("class","my-popup");function f(t,e){y.append("text").attr("fill","#f0f0f0").attr("class","extra label-change").attr("x",x).attr("y",25).text(t).attr("fill",e)}d.on("mouseover",function(t){console.log(t),u.transition().duration(50).style("left",d3.event.pageX-20+"px").style("top",d3.event.pageY-30+"px").style("opacity",1).style("text-align","left"),u.html("\n\t\t\t\t\t\t<div><strong>".concat(t.properties.libepci,"</strong></div>\n\t\t\t\t\t\t")),d3.select(this).attr("fill-opacity",.7)}).on("mouseout",function(t){u.transition().duration(100).style("opacity",0),d3.select(this).attr("fill-opacity",1)});var m=scrollama(),g=document.querySelectorAll(".break-10");m.setup({container:".scroll",graphic:".scroll-graphic",text:".scroll-text",step:".break-10",debug:!1,offset:.6}).onStepEnter(function(t){switch(t.index){case 0:g[0].style.opacity=1,p(),d3.select("#c-svg-10").selectAll(".label-change").remove(),f("Toutes catégories","#fff"),d.transition().duration(250).attr("fill",function(t){return o(t.properties.clust)});break;case 1:g[1].style.opacity=1,d3.select("#c-svg-10-legend").selectAll("*").remove(),d3.select("#c-svg-10").selectAll(".label-change").remove(),f("Jeunes adultes, étudiants et cadres",o.range()[4]),d.transition().duration(250).attr("fill",function(t){return 5==t.properties.clust?o.range()[4]:"#646464"});break;case 2:g[2].style.opacity=1,d3.select("#c-svg-10-legend").selectAll("*").remove(),d3.select("#c-svg-10").selectAll(".label-change").remove(),f("Trentenaires, cadres et prof. int.",o.range()[5]),d.transition().duration(250).attr("fill",function(t){return 6==t.properties.clust?o.range()[5]:"#646464"});break;case 3:g[3].style.opacity=1,d3.select("#c-svg-10-legend").selectAll("*").remove(),d3.select("#c-svg-10").selectAll(".label-change").remove(),f("Employés et ouvriers",o.range()[3]),d.transition().duration(250).attr("fill",function(t){return 4==t.properties.clust?o.range()[3]:"#646464"});break;case 4:g[4].style.opacity=1,d3.select("#c-svg-10-legend").selectAll("*").remove(),d3.select("#c-svg-10").selectAll(".label-change").remove(),f("Ouvriers et jeunes enfants",o.range()[2]),d.transition().duration(250).attr("fill",function(t){return 3==t.properties.clust?o.range()[2]:"#646464"});break;case 5:g[5].style.opacity=1,d3.select("#c-svg-10-legend").selectAll("*").remove(),d3.select("#c-svg-10").selectAll(".label-change").remove(),f("Profil diversifié, plutôt âgé",o.range()[1]),d.transition().duration(250).attr("fill",function(t){return 2==t.properties.clust?o.range()[1]:"#646464"});break;case 6:g[6].style.opacity=1,d3.select("#c-svg-10-legend").selectAll("*").remove(),d3.select("#c-svg-10").selectAll(".label-change").remove(),f("Retraités",o.range()[0]),d.transition().duration(250).attr("fill",function(t){return 1==t.properties.clust?o.range()[0]:"#646464"})}}).onStepExit(function(t){switch(t.index){case 0:g[0].style.opacity=.4;break;case 1:g[1].style.opacity=.4;break;case 2:g[2].style.opacity=.4;break;case 3:g[3].style.opacity=.4;break;case 4:g[4].style.opacity=.4;break;case 5:g[5].style.opacity=.4;break;case 6:g[6].style.opacity=.4}})})}function graph11(){var y=20,h=document.querySelector(".niv2 p").clientWidth,_=d3.select("#c-svg-11").append("svg").attr("height",400).attr("width",h);d3.formatDefaultLocale({decimal:",",thousands:" ",grouping:[3]}),Promise.all([d3.json("data/map/epci.json"),d3.json("data/map/epci_reg.json"),d3.csv("data/csv/data-11.csv")]).then(function(t){for(var e=d3.scaleOrdinal().domain(["0_0","0_1","1_0","1_1",""]).range(["#ddb544","#d077a8","#e5484e","#7d84c0","#646464"]),a=topojson.feature(t[0],t[0].objects.epci_gen),r=topojson.feature(t[1],t[1].objects.epci_reg_gen),n=0;n<t[2].length;n++)for(var l=t[2][n].codepci,o=0;o<a.features.length;o++){if(l===a.features[o].properties.codepci){a.features[o].properties.cat_cs3=t[2][n].cat_cs3,a.features[o].properties.cat_cs6=t[2][n].cat_cs6,a.features[o].properties.cat_cs7=t[2][n].cat_cs7,a.features[o].properties.cat_cs8=t[2][n].cat_cs8,a.features[o].properties.lib_cs3=t[2][n].lib_cs3,a.features[o].properties.lib_cs6=t[2][n].lib_cs6,a.features[o].properties.lib_cs7=t[2][n].lib_cs7,a.features[o].properties.lib_cs8=t[2][n].lib_cs8;break}}var s=d3.geoConicConformal().fitSize([h,400],a),c=d3.geoPath().projection(s),i=_.append("g"),d=i.append("g").attr("class","c-epci").selectAll(".epci").data(a.features).join("path").attr("d",c).attr("class","epci").attr("stroke","white").attr("stroke-width",.1).attr("fill","#646464");i.append("g").attr("class","c-reg").append("path").datum(r).attr("d",c).attr("class","region");_.call(d3.zoom().scaleExtent([1,6]).translateExtent([[0,0],[h,400]]).on("zoom",function(){i.attr("transform",d3.event.transform)}).on("start",function(){d.on("mouseover",null)}).on("end",function(){switch(document.querySelector("#label-change-csp").textContent){case"Groupes socioprofessionnels":m("");break;case"Étudiants":m("lib_cs8");break;case"Retraités":m("lib_cs7");break;case"Ouvriers et employés":m("lib_cs6");break;case"Cadres et prof. int. sup.":m("lib_cs3")}})),_.append("line").attr("class","extra line-extra").attr("x1",y).attr("y1",5).attr("x2",180+y).attr("y2",5).attr("stroke","#fff"),_.append("line").attr("class","extra line-extra").attr("x1",y).attr("y1",35).attr("x2",180+y).attr("y2",35).attr("stroke","#fff");var p=["Faible part du groupe et forte baisse de cette part","Forte part du groupe et forte baisse de cette part","Faible aprt du groupe et forte hausse de cette part","Forte part du groupe et forte hausse de cette part"],u=d3.select("#c-svg-11-legend").append("svg").attr("width",h).attr("height",85).selectAll(".legend").data(e.range()).enter().append("g").attr("class","legend");u.append("rect").attr("x",h/3-20).attr("y",function(t,e){return 20*e+10}).attr("width",23).attr("height",12).style("stroke","black").style("stroke-width",.1).style("fill",function(t){return t}),u.append("text").attr("fill","#f0f0f0").attr("x",h/3+10).attr("y",function(t,e){return 15+20*e}).attr("dy","0.5em").text(function(t,e){return p[e]});var f=d3.select("body").append("div").attr("class","my-popup");function m(e){d.on("mouseover",function(t){f.transition().duration(50).style("left",d3.event.pageX-20+"px").style("top",d3.event.pageY-30+"px").style("opacity",1).style("text-align","left"),f.html("\n\t\t\t\t\t\t\t<div><strong>".concat(t.properties.libepci,"</strong></div>\n\t\t\t\t\t\t\t<div>").concat(t.properties[e],"</div>\n\t\t\t\t\t\t\t")),d3.select(this).attr("fill-opacity",.7)}).on("mouseout",function(t){f.transition().duration(100).style("opacity",0),d3.select(this).attr("fill-opacity",1)})}function g(t){_.append("text").attr("class","extra label-change").attr("id","label-change-csp").attr("x",y).attr("y",25).attr("fill","#fff").text(t)}var x=scrollama(),v=document.querySelectorAll(".break-11");x.setup({container:".scroll",graphic:".scroll-graphic",text:".scroll-text",step:".break-11",debug:!1,offset:.6}).onStepEnter(function(t){switch(t.index){case 0:v[0].style.opacity=1,d3.select("#c-svg-11").selectAll(".label-change").remove(),g("Groupes socioprofessionnels"),m(""),d.transition().duration(250).attr("fill","#646464");break;case 1:v[1].style.opacity=1,d3.select("#c-svg-11").selectAll(".label-change").remove(),g("Étudiants"),m("lib_cs8"),d.transition().duration(250).attr("fill",function(t){return e(t.properties.cat_cs8)});break;case 2:v[2].style.opacity=1,d3.select("#c-svg-11").selectAll(".label-change").remove(),g("Retraités"),m("lib_cs7"),d.transition().duration(250).attr("fill",function(t){return e(t.properties.cat_cs7)});break;case 3:v[3].style.opacity=1,d3.select("#c-svg-11").selectAll(".label-change").remove(),g("Ouvriers et employés"),m("lib_cs6"),d.transition().duration(250).attr("fill",function(t){return e(t.properties.cat_cs6)});break;case 4:v[4].style.opacity=1,d3.select("#c-svg-11").selectAll(".label-change").remove(),g("Cadres et prof. int. sup."),m("lib_cs3"),d.transition().duration(250).attr("fill",function(t){return e(t.properties.cat_cs3)})}}).onStepExit(function(t){switch(t.index){case 0:v[0].style.opacity=.4;break;case 1:v[1].style.opacity=.4;break;case 2:v[2].style.opacity=.4;break;case 3:v[3].style.opacity=.4;break;case 4:v[4].style.opacity=.4}})})}function graph1Min(o){var s=document.querySelector(".niv2 p").clientWidth,t=400,c=d3.select(o).append("svg").attr("height",t).attr("width",s),i=c.append("g").attr("transform","translate("+s/2+",200)");d3.formatDefaultLocale({decimal:",",thousands:" ",grouping:[3]});var d=d3.forceSimulation().force("x",d3.forceX().strength(.05)).force("y",d3.forceY().strength(.05)).force("collide",d3.forceCollide(5)).force("charge",d3.forceManyBody().strength(-1)),p=d3.scaleOrdinal().domain(["immob","mob_com","mob_dep","mob_reg","mob_france","mob_all"]).range(["#eaeaea","#7b7fbc","#7dbd9f","#f8c351","#f18757","#e85754"]);d3.csv("data/csv/data-01.csv").then(function(t){var e=i.append("g").selectAll(".people");function a(t){(e=e.data(t)).exit().remove(),e=e.enter().append("circle").attr("class","people").attr("r",2).attr("fill",function(t){return p(t.type_mob)}).merge(e),d.nodes(t).on("tick",r)}function r(){e.attr("cx",function(t){return t.x}).attr("cy",function(t){return t.y+20})}e.on("click",function(t){console.log(t)});var n={0:{x:50-s/4,y:200},1:{x:50+s/4,y:200}},l={mob_com:{x:-2*s/6,y:200},mob_dep:{x:-s/6,y:200},mob_reg:{x:0,y:200},mob_france:{x:s/6,y:200},mob_all:{x:2*s/6,y:200},immob:{x:0,y:0}};(c.append("text").attr("class","extra label-change").attr("x",20).attr("y",25).attr("fill","#f0f0f0").text("En 2014, en France"),c.append("line").attr("class","extra line-extra").attr("x1",20).attr("y1",5).attr("x2",180).attr("y2",5).attr("stroke","#fff"),c.append("line").attr("class","extra line-extra").attr("x1",20).attr("y1",35).attr("x2",180).attr("y2",35).attr("stroke","#fff"),"#c-svg-01-min-1"==o)?(a(t),d.force("x",d3.forceX().strength(.05).x(function(t){return n[t.value].x})),d.alpha(1).restart(),d3.select("#c-svg-01").selectAll(".label-text").remove(),d3.select("#c-svg-01").selectAll(".label-line").remove(),c.append("text").attr("class","label-text").attr("x",50+s/4).attr("y",70).attr("text-anchor","middle").attr("fill","#f0f0f0").text("89 % des individus"),c.append("text").attr("class","label-text").attr("x",50+s/4).attr("y",85).attr("text-anchor","middle").attr("fill","#f0f0f0").text("n'ont pas changé de logement"),c.append("text").attr("class","label-text").attr("x",55+3*s/4).attr("y",150).attr("text-anchor","middle").attr("fill","#f0f0f0").text("11 % des individus"),c.append("text").attr("class","label-text").attr("x",55+3*s/4).attr("y",165).attr("text-anchor","middle").attr("fill","#f0f0f0").text("ont changé de logement")):(a(t.filter(function(t){return"1"==t.value})),d.force("x",d3.forceX().strength(.05).x(function(t){return l[t.type_mob].x})),d.alpha(1).restart(),d3.select("#c-svg-01").selectAll(".label-text").remove(),d3.select("#c-svg-01").selectAll(".label-line").remove(),c.append("text").attr("class","label-text").attr("x",10+s/6).attr("y",120).attr("text-anchor","middle").attr("fill","#f0f0f0").text("4 % sont restés"),c.append("text").attr("class","label-text").attr("x",10+s/6).attr("y",135).attr("text-anchor","middle").attr("fill","#f0f0f0").text("dans la même commune"),c.append("text").attr("class","label-text").attr("x",10+2*s/6).attr("y",300).attr("text-anchor","middle").attr("fill","#f0f0f0").text("4,1 % ont changé de commune"),c.append("text").attr("class","label-text").attr("x",10+2*s/6).attr("y",315).attr("text-anchor","middle").attr("fill","#f0f0f0").text("au sein du même département"),c.append("text").attr("class","label-text").attr("x",10+s/2).attr("y",120).attr("text-anchor","middle").attr("fill","#f0f0f0").text("1,2 % ont changé de département"),c.append("text").attr("class","label-text").attr("x",10+s/2).attr("y",135).attr("text-anchor","middle").attr("fill","#f0f0f0").text("au sein de la même région"),c.append("text").attr("class","label-text").attr("x",5+2*s/3).attr("y",300).attr("text-anchor","middle").attr("fill","#f0f0f0").text("1,6 % ont changé"),c.append("text").attr("class","label-text").attr("x",5+2*s/3).attr("y",315).attr("text-anchor","middle").attr("fill","#f0f0f0").text("de région"),c.append("text").attr("class","label-text").attr("x",5*s/6).attr("y",120).attr("text-anchor","middle").attr("fill","#f0f0f0").text("0,4 % sont arrivés"),c.append("text").attr("class","label-text").attr("x",5*s/6).attr("y",135).attr("text-anchor","middle").attr("fill","#f0f0f0").text("de l'étranger"),c.append("line").attr("class","label-line").attr("x1",10+s/6).attr("x2",10+s/6).attr("y1",155).attr("y2",175).attr("stroke","#f0f0f0").attr("stroke-width",1),c.append("line").attr("class","label-line").attr("x1",10+2*s/6).attr("x2",10+2*s/6).attr("y1",260).attr("y2",280).attr("stroke","#f0f0f0").attr("stroke-width",1),c.append("line").attr("class","label-line").attr("x1",10+s/2).attr("x2",10+s/2).attr("y1",155).attr("y2",175).attr("stroke","#f0f0f0").attr("stroke-width",1),c.append("line").attr("class","label-line").attr("x1",5+2*s/3).attr("x2",5+2*s/3).attr("y1",260).attr("y2",280).attr("stroke","#f0f0f0").attr("stroke-width",1),c.append("line").attr("class","label-line").attr("x1",5*s/6).attr("x2",5*s/6).attr("y1",155).attr("y2",175).attr("stroke","#f0f0f0").attr("stroke-width",1))})}function graph2Min(t){var i=20,d=20,p=60,u=100,f=document.querySelector(".niv2 p").clientWidth,m=d3.select(t).append("svg").attr("height",400).attr("width",f);d3.formatDefaultLocale({decimal:",",thousands:" ",grouping:[3]});var g=d3.format(".2n");d3.csv("data/csv/data-02.csv").then(function(t){t.forEach(function(t){t.meme_com=+t.meme_com,t.change_com=+t.change_com,t.change_dep=+t.change_dep,t.change_reg=+t.change_reg,t.change_int=+t.change_int});var e=t.columns.slice(1,6),a=d3.scaleLinear().domain([0,35]).rangeRound([u,f-d]),r=d3.scaleBand().domain(t.map(function(t){return t.periode})).rangeRound([i,400-p]).paddingInner(.5).align(.1),n=d3.scaleOrdinal().domain(e).range(["#7b7fbd","#7dbd9f","#f8c352","#f18757","#e85654"]),l=d3.axisBottom(a).tickFormat(function(t){return t+" %"}),o=d3.axisLeft(r).tickSizeOuter(0),s=d3.stack();m.append("g").attr("class","axis x_axis").attr("transform","translate(0,".concat(400-p,")")).call(l),m.select(".x_axis").selectAll("text").attr("y",10),m.append("g").attr("class","axis y_axis").attr("transform","translate(".concat(u,",0)")).call(o).select(".domain").remove(),m.selectAll(".serie").data(s.keys(e)(t)).enter().append("g").attr("class","serie").attr("fill",function(t){return n(t.key)}).selectAll("rect").data(function(t){return t}).enter().append("rect").attr("x",function(t){return a(t[0])}).attr("y",function(t){return r(t.data.periode)}).attr("width",function(t){return a(t[1])-a(t[0])}).attr("height",r.bandwidth()),m.append("text").attr("class","label").attr("transform","translate("+(f-d)+" ,"+(400-p/4)+")").style("text-anchor","end").attr("fill","#f0f0f0").text("Part des ménages ayant changé de logement");var c=d3.select("body").append("div").attr("class","my-popup");d3.selectAll("rect").on("mouseover",function(t){c.transition().duration(50).style("left",d3.event.pageX-20+"px").style("top",d3.event.pageY-120+"px").style("opacity",1).style("text-align","left"),c.html("\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<em>Chgt de logement dans la même commune</em> : <span>".concat(g(t.data.meme_com)," % </span>\n\t\t\t\t\t\t\t<br>\n\t\t\t\t\t\t\t<em>Chgt de commune dans le même département</em> : <span>").concat(g(t.data.change_com)," % </span>\n\t\t\t\t\t\t\t<br>\n\t\t\t\t\t\t\t<em>Chgt de département dans la même région</em> : <span>").concat(g(t.data.change_dep)," % </span>\n\t\t\t\t\t\t\t<br>\n\t\t\t\t\t\t\t<em>Chgt de région en France</em> : <span>").concat(g(t.data.change_reg)," % </span>\n\t\t\t\t\t\t\t<br>\n\t\t\t\t\t\t\t<em>Arrivée depuis l'étranger</em> : <span>").concat(g(t.data.change_int)," % </span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t"))}).on("mouseout",function(t){c.transition().duration(100).style("opacity",0)})})}window.addEventListener("resize",function(){deplaceOutputBullet3()}),window.addEventListener("load",function(){"none"==getComputedStyle(document.querySelector(".c-graphic-min")).display&&graph7()}),graph8(),window.addEventListener("load",function(){"none"==getComputedStyle(document.querySelector(".c-graphic-min")).display&&graph10()}),window.addEventListener("load",function(){"none"==getComputedStyle(document.querySelector(".c-graphic-min")).display&&graph11()}),"block"==getComputedStyle(document.querySelector(".c-graphic-min")).display&&(graph1Min("#c-svg-01-min-1"),graph1Min("#c-svg-01-min-2")),window.addEventListener("load",function(){"block"==getComputedStyle(document.querySelector(".c-graphic-min")).display&&graph2Min("#c-svg-02-min")});var inputValuesMin=["1968-1975","1975-1982","1982-1990","1990-1999","1999-2009","2009-2014"],input03Min=document.querySelector("#input-03"),output03Min=document.querySelector("#c-output-03"),output03BulletMin=document.querySelector("#output-03-bullet");function graph3Min(f){var m=20,g=document.querySelector(".niv2 p").clientWidth,x=d3.select(f).append("svg").attr("height",400).attr("width",g);d3.formatDefaultLocale({decimal:",",thousands:" ",grouping:[3]}),Promise.all([d3.json("data/map/rw_19681975.json"),d3.json("data/map/rw_19751982.json"),d3.json("data/map/rw_19821990.json"),d3.json("data/map/rw_19901999.json"),d3.json("data/map/rw_19992009.json"),d3.json("data/map/rw_20092014.json")]).then(function(t){var e=topojson.feature(t[0],t[0].objects.rw_19681975),a=topojson.feature(t[1],t[1].objects.rw_19751982),r=topojson.feature(t[2],t[2].objects.rw_19821990),n=topojson.feature(t[3],t[3].objects.rw_19901999),l=topojson.feature(t[4],t[4].objects.rw_19992009),o=topojson.feature(t[5],t[5].objects.rw_20092014),s=d3.geoConicConformal().fitSize([g,400],e),c=d3.geoPath().projection(s),i=x.append("g"),d=d3.scaleOrdinal().domain(["inf_-2","-2_-1","-1_0","0_1","1_2","2_3","sup_3"]).range(["#10524d","#229f97","#add9dc","#f9d7ad","#e89c3f","#ab6016","#693e0f"]);function p(t,e){x.append("text").attr("class","label-change label-change2").attr("x",90).attr("y",25).attr("fill","#f0f0f0").text(e);i.selectAll(".rw").data(t).join("path").attr("d",c).attr("class","rw").attr("stroke","white").attr("stroke-width",.1).attr("fill",function(t){return d(t.properties.classe)})}x.append("text").attr("class","extra label-change").attr("x",20).attr("y",25).attr("fill","#f0f0f0").text("Période"),x.append("line").attr("class","extra line-extra").attr("x1",m).attr("y1",5).attr("x2",180).attr("y2",5).attr("stroke","#fff"),x.append("line").attr("class","extra line-extra").attr("x1",m).attr("y1",35).attr("x2",180).attr("y2",35).attr("stroke","#fff"),x.call(d3.zoom().on("zoom",function(){i.attr("transform",d3.event.transform)}).scaleExtent([1,6]).translateExtent([[0,0],[g,400]])),input03Min.oninput();var u=function(){var t=input03Min.value/input03Min.max;output03BulletMin.style.left=t*input03Min.getBoundingClientRect().width*.9221018907+"px"};p(o.features,inputValuesMin[5]),u(),input03Min.addEventListener("input",function(t){switch(u(),t.target.value){case"0":d3.select(f).selectAll(".label-change2").remove(),p(e.features,inputValuesMin[0]);break;case"1":d3.select(f).selectAll(".label-change2").remove(),p(a.features,inputValuesMin[1]);break;case"2":d3.select(f).selectAll(".label-change2").remove(),p(r.features,inputValuesMin[2]);break;case"3":d3.select(f).selectAll(".label-change2").remove(),p(n.features,inputValuesMin[3]);break;case"4":d3.select(f).selectAll(".label-change2").remove(),p(l.features,inputValuesMin[4]);break;case"5":d3.select(f).selectAll(".label-change2").remove(),p(o.features,inputValuesMin[5])}})})}output03Min.oninput=function(){output03BulletMin.innerHTML=inputValuesMin[this.value]},output03Min.oninput(),window.addEventListener("load",function(){"block"==getComputedStyle(document.querySelector(".c-graphic-min")).display&&graph3Min("#c-svg-03-min")});var inputValues2Min=["1968-1975","1975-1982","1982-1990","1990-1999","1999-2009","2009-2014"],input04Min=document.querySelector("#input-04"),output04Min=document.querySelector("#c-output-04"),output04BulletMin=document.querySelector("#output-04-bullet");output04Min.oninput=function(){output04BulletMin.innerHTML=inputValues2Min[this.value]},input04Min.oninput();var deplaceOutputBullet2Min=function(){var t=output04Min.value/output04Min.max;output04BulletMin.style.left=t*output04Min.getBoundingClientRect().width*.9221018907+"px"};function graph4Min(s){var u=60,f=20,m=70,g=20,x=document.querySelector(".niv2 p").clientWidth,v=d3.select(s).append("svg").attr("height",400).attr("width",x);d3.formatDefaultLocale({decimal:",",thousands:" ",grouping:[3]});var y=d3.format(".2n"),h=d3.format(",.0f"),_=d3.format("");d3.csv("data/csv/data-04.csv").then(function(c){c.forEach(function(t){t.pop_sm_68_75=+t.pop_sm_68_75,t.pop_sm_75_82=+t.pop_sm_75_82,t.pop_sm_82_90=+t.pop_sm_82_90,t.pop_sm_90_99=+t.pop_sm_90_99,t.pop_sm_99_09=+t.pop_sm_99_09,t.pop_sm_09_14=+t.pop_sm_09_14,t.tx_sm_68_75=+t.tx_sm_68_75,t.tx_sm_75_82=+t.tx_sm_75_82,t.tx_sm_82_90=+t.tx_sm_82_90,t.tx_sm_90_99=+t.tx_sm_90_99,t.tx_sm_99_09=+t.tx_sm_99_09,t.tx_sm_09_14=+t.tx_sm_09_14});var i=d3.scaleOrdinal().domain(["01","02","03","04","11","24","27","28","32","44","52","53","75","76","84","93","94"]).range(["#faa61a","#fec641","#bb529e","#b71f2b","#ccecfa","#d8c470","#a7d48c","#f8d6c7","#bcbcbc","#f9f49b","#eec0d9","#abdfeb","#cfe295","#f79868","#9fc9eb","#f9b132","#a9d9bc"]),t=c.columns.slice(8,14),e=d3.max(c,function(e){return d3.max(t,function(t){return e[t]})}),a=d3.min(c,function(e){return d3.min(t,function(t){return e[t]})}),r=c.columns.slice(2,8),d=d3.max(c,function(e){return d3.max(r,function(t){return e[t]})}),p=d3.scaleLinear().domain([a,e]).range([g,x-f]).nice(),n=d3.axisBottom(p).tickSizeOuter(0).tickFormat(function(t){return _(t)+" %"});function l(e,a,t){v.append("text").attr("class","label-change label-change2").attr("x",90).attr("y",25).attr("fill","#f0f0f0").text(t);for(var r=d3.forceSimulation(c).force("x",d3.forceX(function(t){return p(t[e])}).strength(1)).force("y",d3.forceY(200-m/2)).force("collide",d3.forceCollide().radius(function(t){return 50*Math.sqrt(t[a]/d)})).stop(),n=0;n<c.length;n++)r.tick();var l=v.selectAll(".circles").data(c,function(t){return t.codgeo});l.exit().transition().duration(1e3).attr("cx",0).attr("cy",200-m/2).remove();var o=l.enter().append("g").attr("id",function(t){return"g-"+t.codgeo});o.append("circle").attr("class","circles").attr("r",1).attr("cx",function(t){return t.x}).attr("cy",function(t){return t.y}).attr("fill",function(t){return i(t.codgeo)}).merge(l).transition().duration(1500).attr("cx",function(t){return t.x}).attr("cy",function(t){return t.y}).attr("r",function(t){return 50*Math.sqrt(t[a]/d)});var s=d3.select("body").append("div").attr("class","my-popup");o.on("mouseover",function(t){s.transition().duration(50).style("left",d3.event.pageX-20+"px").style("top",d3.event.pageY-10+"px").style("opacity",1).style("text-align","left"),s.html("\n\t\t\t\t\t\t\t<div><strong>".concat(t.libgeo,"</strong></div>\n\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t<div>Solde migratoire annuel moyen</div>\n\t\t\t\t\t\t\t\t<span>").concat(h(t[a])," </span>\n\t\t\t\t\t\t\t\t<div>Taux d'évolution de la population</div>\n\t\t\t\t\t\t\t\t<span>").concat(y(t[e])," % </span>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t")),d3.select(this).attr("fill-opacity",.7)}).on("mouseout",function(t){s.transition().duration(100).style("opacity",0),d3.select(this).attr("fill-opacity",1)})}v.append("text").attr("class","extra label-change").attr("x",20).attr("y",25).attr("fill","#f0f0f0").text("Période"),v.append("line").attr("class","extra line-extra").attr("x1",g).attr("y1",5).attr("x2",180).attr("y2",5).attr("stroke","#fff"),v.append("line").attr("class","extra line-extra").attr("x1",g).attr("y1",35).attr("x2",180).attr("y2",35).attr("stroke","#fff"),v.append("g").attr("class","axis x_axis").attr("transform","translate(0,".concat(400-m,")")).call(n),v.select(".x_axis").selectAll("text").attr("y",10),v.append("line").attr("x1",p(0)).attr("x2",p(0)).attr("y1",u).attr("y2",400-m).attr("stroke","#fff").attr("stroke-width",2);var o=v.append("g").attr("class","circle-legend");o.append("text").attr("class","label-circle").attr("x",6*x/7-20).attr("y",25).attr("fill","#f0f0f0").text("Solde migratoire annuel moyen"),o.append("circle").attr("cx",6*x/7-20).attr("cy",u+40).attr("r",50*Math.sqrt(d/d)),o.append("circle").attr("cx",6*x/7-20).attr("cy",u+40+50*Math.sqrt(25e3/d)/2).attr("r",50*Math.sqrt(25e3/d)),o.append("circle").attr("cx",6*x/7-20).attr("cy",u+40+50*Math.sqrt(25e3/d)).attr("r",50*Math.sqrt(5e3/d)),o.append("text").attr("class","label-circle").attr("x",6*x/7-20).attr("y",u/2+15).text(h(d)),o.append("text").attr("class","label-circle").attr("x",6*x/7-20).attr("y",u/2+50*Math.sqrt(25e3/d)+15).text(h(5e3)),o.append("text").attr("class","label-circle").attr("x",6*x/7-20).attr("y",u/2+2*Math.sqrt(25e3/d)*50+15).text(h(1e3)),l("tx_sm_09_14","pop_sm_09_14",inputValues2Min[5]),deplaceOutputBullet2Min(),input04Min.addEventListener("input",function(t){switch(deplaceOutputBullet2Min(),t.target.value){case"0":d3.select(s).selectAll(".label-change2").remove(),l("tx_sm_68_75","pop_sm_68_75",inputValues2Min[0]);break;case"1":d3.select(s).selectAll(".label-change2").remove(),l("tx_sm_75_82","pop_sm_75_82",inputValues2Min[1]);break;case"2":d3.select(s).selectAll(".label-change2").remove(),l("tx_sm_82_90","pop_sm_82_90",inputValues2Min[2]);break;case"3":d3.select(s).selectAll(".label-change2").remove(),l("tx_sm_90_99","pop_sm_90_99",inputValues2Min[3]);break;case"4":d3.select(s).selectAll(".label-change2").remove(),l("tx_sm_99_09","pop_sm_99_09",inputValues2Min[4]);break;case"5":d3.select(s).selectAll(".label-change2").remove(),l("tx_sm_09_14","pop_sm_09_14",inputValues2Min[5])}})})}function graph5Min(t){var u=document.querySelector(".niv2 p").clientWidth,f=d3.select(t).append("svg").attr("height",400).attr("width",u);d3.formatDefaultLocale({decimal:",",thousands:" ",grouping:[3]});var m=d3.format(".2n");Promise.all([d3.json("data/map/dep.json"),d3.json("data/map/dep_reg.json"),d3.csv("data/csv/data-05.csv")]).then(function(t){for(var e=topojson.feature(t[0],t[0].objects.dep_gen_wgs84),a=topojson.feature(t[1],t[1].objects.dep_reg_gen_wgs84),r=0;r<t[2].length;r++)for(var n=t[2][r].coddep,l=0;l<e.features.length;l++){if(n===e.features[l].properties.coddep){e.features[l].properties.tx_19992009=t[2][r].tx_19992009,e.features[l].properties.tx_20092014=t[2][r].tx_20092014,e.features[l].properties.quali=t[2][r].quali;break}}var o=d3.scaleOrdinal().domain(["0_0","0_1","0_2","1_0","1_1","1_2","2_0","2_1","2_2"]).range(["#045364","#1a5230","#ad6116","#26a199","#39a065","#e89e3f","#aedbde","#b0d8bd","#fad8af"]),s=d3.geoConicConformal().fitSize([u,400],e),c=d3.geoPath().projection(s),i=f.append("g"),d=i.append("g").attr("class","c-dep").selectAll(".dep").data(e.features).join("path").attr("d",c).attr("class","dep").attr("stroke","white").attr("stroke-width",.1).attr("fill",function(t){return o(t.properties.quali)});i.append("g").attr("class","c-reg").append("path").datum(a).attr("d",c).attr("class","region");f.call(d3.zoom().scaleExtent([1,6]).translateExtent([[0,0],[u,400]]).on("zoom",function(){i.attr("transform",d3.event.transform)}).on("start",function(){d.on("mouseover",null)}).on("end",function(){d.on("mouseover",function(t){console.log(t),p.transition().duration(50).style("left",d3.event.pageX-20+"px").style("top",d3.event.pageY-100+"px").style("opacity",1).style("text-align","left"),p.html("\n\t\t\t\t\t\t\t<div><strong>".concat(t.properties.libdep,"</strong></div>\n\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t<div>Croissance migratoire</div>\n\t\t\t\t\t\t\t\t<em>1999-2009</em> : <span>").concat(m(t.properties.tx_19992009)," % </span>\n\t\t\t\t\t\t\t\t<br>\n\t\t\t\t\t\t\t\t<em>2009-2014</em> : <span>").concat(m(t.properties.tx_20092014)," % </span>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t")),d3.select(this).attr("fill-opacity",.7)})}));var p=d3.select("body").append("div").attr("class","my-popup");d.on("mouseover",function(t){console.log(t),p.transition().duration(50).style("left",d3.event.pageX-20+"px").style("top",d3.event.pageY-100+"px").style("opacity",1).style("text-align","left"),p.html("\n\t\t\t\t\t\t<div><strong>".concat(t.properties.libdep,"</strong></div>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<div>Évolution migratoire</div>\n\t\t\t\t\t\t\t<em>1999-2009</em> : <span>").concat(m(t.properties.tx_19992009)," % </span>\n\t\t\t\t\t\t\t<br>\n\t\t\t\t\t\t\t<em>2009-2014</em> : <span>").concat(m(t.properties.tx_20092014)," % </span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t")),d3.select(this).attr("fill-opacity",.7)}).on("mouseout",function(t){p.transition().duration(100).style("opacity",0),d3.select(this).attr("fill-opacity",1)})})}function graph6Min(t){var _=35,b=20,k=30,w=50,A=document.querySelector(".niv2 p").clientWidth,S=d3.select(t).append("svg").attr("height",400).attr("width",A);d3.formatDefaultLocale({decimal:",",thousands:" ",grouping:[3]});var M=d3.format("");d3.csv("data/csv/data-06.csv").then(function(t){t.forEach(function(t){t[111]=+t[111],t[112]=+t[112],t[120]=+t[120],t[211]=+t[211],t[212]=+t[212],t[221]=+t[221],t[222]=+t[222],t[300]=+t[300],t[400]=+t[400]});var a=t.columns.slice(1,10),e=d3.max(t,function(e){return d3.max(a,function(t){return e[t]})}),r=d3.min(t,function(e){return d3.min(a,function(t){return e[t]})}),n=d3.scaleLinear().domain(d3.extent(t,function(t){return t.year})).range([w,A-b]),l=d3.scaleLinear().domain([r,e]).nice().range([400-k,_]),o=d3.axisBottom(n).tickSizeOuter(0),s=d3.axisLeft(l).ticks(5).tickSizeOuter(0).tickFormat(function(t){return M(t)+" %"});S.append("g").attr("class","axis x_axis").attr("transform","translate(0,".concat(400-k,")")).call(o),S.select(".x_axis").selectAll("text").attr("y",10),S.append("g").attr("class","axis y_axis").attr("transform","translate(".concat(w,",0)")).call(s),S.select(".y_axis").selectAll("text").attr("x",-10).attr("dy",3);var c=d3.line().x(function(t){return n(t.year)}).y(function(t){return l(t[111])}).curve(d3.curveMonotoneX),i=d3.line().x(function(t){return n(t.year)}).y(function(t){return l(t[112])}).curve(d3.curveMonotoneX),d=d3.line().x(function(t){return n(t.year)}).y(function(t){return l(t[120])}).curve(d3.curveMonotoneX),p=d3.line().x(function(t){return n(t.year)}).y(function(t){return l(t[211])}).curve(d3.curveMonotoneX),u=d3.line().x(function(t){return n(t.year)}).y(function(t){return l(t[212])}).curve(d3.curveMonotoneX),f=d3.line().x(function(t){return n(t.year)}).y(function(t){return l(t[221])}).curve(d3.curveMonotoneX),m=d3.line().x(function(t){return n(t.year)}).y(function(t){return l(t[222])}).curve(d3.curveMonotoneX),g=d3.line().x(function(t){return n(t.year)}).y(function(t){return l(t[300])}).curve(d3.curveMonotoneX),x=d3.line().x(function(t){return n(t.year)}).y(function(t){return l(t[400])}).curve(d3.curveMonotoneX);S.append("line").attr("x1",w).attr("x2",A-b).attr("y1",l(0)).attr("y2",l(0)).attr("stroke","#fff").attr("stroke-width",2),S.append("path").datum(t).attr("class","line").attr("d",c),S.append("path").datum(t).attr("class","line").attr("d",i),S.append("path").datum(t).attr("class","line").attr("d",d),S.append("path").datum(t).attr("class","line").attr("d",p),S.append("path").datum(t).attr("class","line").attr("d",u),S.append("path").datum(t).attr("class","line").attr("d",f),S.append("path").datum(t).attr("class","line").attr("d",m),S.append("path").datum(t).attr("class","line").attr("d",g),S.append("path").datum(t).attr("class","line").attr("d",x);var v=["#c90c10","#f49829","#f9d333","#a31876","#ca75ad","#0a9ba2","#8acdd2","#ccc1da","#f2f4ee"],y=document.querySelectorAll(".line");Array.from(y).forEach(function(t,e){t.setAttribute("stroke",v[e])});var h=d3.select("body").append("div").attr("class","my-popup");d3.selectAll(".lineZAU").on("mouseover",function(t,e){switch(h.transition().duration(50).style("left",d3.event.pageX-20+"px").style("top",d3.event.pageY-30+"px").style("opacity",1).style("text-align","left"),e){case 0:h.html("\n\t\t\t\t\t\t\t<div><strong>Grands pôles</strong></div>\n\t\t\t\t\t\t\t");break;case 1:h.html("\n\t\t\t\t\t\t\t<div><strong>Couronnes de grands pôles</strong></div>\n\t\t\t\t\t\t\t");break;case 2:h.html("\n\t\t\t\t\t\t\t<div><strong>Communes multipolarisées des grandes aires urbaines</strong></div>\n\t\t\t\t\t\t\t");break;case 3:h.html("\n\t\t\t\t\t\t\t<div><strong>Pôles moyens</strong></div>\n\t\t\t\t\t\t\t");break;case 4:h.html("\n\t\t\t\t\t\t\t<div><strong>Couronnes des pôles moyens</strong></div>\n\t\t\t\t\t\t\t");break;case 5:h.html("\n\t\t\t\t\t\t\t<div><strong>Petits pôles</strong></div>\n\t\t\t\t\t\t\t");break;case 6:h.html("\n\t\t\t\t\t\t\t<div><strong>Couronnes des petits pôles</strong></div>\n\t\t\t\t\t\t\t");break;case 7:h.html("\n\t\t\t\t\t\t\t<div><strong>Autres communes multipolarisées</strong></div>\n\t\t\t\t\t\t\t");break;case 8:h.html("\n\t\t\t\t\t\t\t<div><strong>Communes isolées, hors influence des pôles</strong></div>\n\t\t\t\t\t\t\t")}d3.select(this).attr("fill-opacity",.7)}).on("mouseout",function(t){h.transition().duration(100).style("opacity",0),d3.select(this).attr("fill-opacity",1)})})}window.addEventListener("resize",function(){deplaceOutputBullet2Min()}),window.addEventListener("load",function(){"block"==getComputedStyle(document.querySelector(".c-graphic-min")).display&&graph4Min("#c-svg-04-min")}),window.addEventListener("load",function(){"block"==getComputedStyle(document.querySelector(".c-graphic-min")).display&&graph5Min("#c-svg-05-min")}),window.addEventListener("load",function(){"block"==getComputedStyle(document.querySelector(".c-graphic-min")).display&&graph6Min("#c-svg-06-min")});var inputValues3Min=["1968-1975","1975-1982","1982-1990","1990-1999","1999-2009","2009-2014"],input07Min=document.querySelector("#input-07"),output07Min=document.querySelector("#c-output-07"),output07BulletMin=document.querySelector("#output-07-bullet");input07Min.oninput=function(){output07BulletMin.innerHTML=inputValues3Min[this.value]},input07Min.oninput();var deplaceOutputBullet3Min=function(){var t=input07Min.value/input07Min.max;output07BulletMin.style.left=t*input07Min.getBoundingClientRect().width*.9221018907+"px"};function graph7Min(b){var k=110,w=40,A=60,S=50,M=document.querySelector(".niv2 p").clientWidth,q=d3.select(b).append("svg").attr("height",500).attr("width",M);d3.formatDefaultLocale({decimal:",",thousands:" ",grouping:[3]});var j=d3.format(".2n"),C=(d3.format(",.0f"),d3.format(""));d3.csv("data/csv/data-07.csv").then(function(d){d.forEach(function(t,e){for(var a in t)+t[a]==+t[a]&&(t[a]=+t[a])});var t=d.columns.slice(14,20),a=d.columns.slice(20,28),r=d.columns.slice(2,8),n=d.columns.slice(8,14),e=d3.max(d,function(e){return d3.max(t,function(t){return e[t]})}),l=d3.min(d,function(e){return d3.min(t,function(t){return e[t]})}),o=d3.max(d,function(e){return d3.max(a,function(t){return e[t]})}),s=d3.min(d,function(e){return d3.min(a,function(t){return e[t]})}),p=d3.max(d,function(e){return d3.max(r,function(t){return e[t]})}),c=d3.min(d,function(e){return d3.min(n,function(t){return e[t]})}),i=d3.max(d,function(e){return d3.max(n,function(t){return e[t]})}),u=d3.scaleLinear().domain([l,e]).range([S,M-w]).nice(),f=d3.scaleLinear().domain([s,o]).range([500-A,k]).nice(),m=d3.axisBottom(u).ticks(5).tickSizeOuter(0).tickFormat(function(t){return C(t)+" %"}),g=d3.axisLeft(f).ticks(5).tickSizeOuter(0).tickFormat(function(t){return C(t)+" %"});q.append("g").attr("class","axis x_axis").attr("transform","translate(0,".concat(500-A,")")).call(m),q.select(".x_axis").selectAll("text").attr("y",10),q.append("g").attr("class","axis y_axis").attr("transform","translate(".concat(S,",0)")).call(g),q.append("line").attr("x1",u(0)).attr("x2",u(0)).attr("y1",k).attr("y2",500-A).attr("stroke","#fff").attr("stroke-width",2),q.append("line").attr("x1",S).attr("x2",M-w).attr("y1",f(0)).attr("y2",f(0)).attr("stroke","#fff").attr("stroke-width",2);var x=d3.scaleLinear().domain([c,-.25,0,.5,1,i]).range(["#c8c6c6","#dbecdb","#b79bc9","#7959a2","#5d36bc"]),v=d3.scaleOrdinal().domain(111,112,120,211,212,221,222,300,400).range(["#c90c10","#f49829","#f9d333","#a31876","#ca75ad","#0a9ba2","#8acdd2","#ccc1da","#f2f4ee"]);q.append("text").attr("fill","#f0f0f0").attr("class","extra label-change").attr("x",S).attr("y",25).text("Période"),q.append("line").attr("class","extra line-extra").attr("x1",S).attr("y1",5).attr("x2",180+S).attr("y2",5).attr("stroke","#fff"),q.append("line").attr("class","extra line-extra").attr("x1",S).attr("y1",35).attr("x2",180+S).attr("y2",35).attr("stroke","#fff"),q.append("text").attr("fill","#f0f0f0").attr("class","label").attr("y",k/2+25).attr("x",S/2).style("text-anchor","start").text("Taux d'évolution de la population"),q.append("text").attr("fill","#f0f0f0").attr("class","label").attr("y",k/2+40).attr("x",S/2).style("text-anchor","start").text("due au solde migratoire apparent"),q.append("text").attr("class","label").attr("transform","translate("+(M-w)+" ,"+(500-A/3)+")").style("text-anchor","end").attr("fill","#f0f0f0").text("Taux d'évolution de la population"),q.append("text").attr("class","label").attr("transform","translate("+(M-w)+" ,"+(500-A/3+15)+")").style("text-anchor","end").attr("fill","#f0f0f0").text("due au solde naturel");var y=q.selectAll(".legend").data(x.range()).enter().append("g").attr("class","legend");function h(e,a,r,n,t){q.append("text").attr("fill","#f0f0f0").attr("class","label-change label-change2").attr("x",70+S).attr("y",25).text(t);for(var l=d3.forceSimulation(d).force("x",d3.forceX(function(t){return u(t[r])}).strength(1)).force("y",d3.forceY(function(t){return f(t[n])}).strength(1)).stop(),o=0;o<d.length;o++)l.tick();var s=q.selectAll(".circles").data(d,function(t){return t.codgeo});s.exit().transition().duration(1e3).attr("cx",0).attr("cy",250-A/2).remove();var c=s.enter().append("g").attr("id",function(t){return"g-"+t.codgeo});c.append("circle").attr("class","circles").attr("r",1).attr("cx",function(t){return t.x}).attr("cy",function(t){return t.y}).attr("stroke",function(t){return v(t.codgeo)}).attr("stroke-width",3).merge(s).transition().duration(1500).attr("fill",function(t){return x(t[a])}).attr("cx",function(t){return t.x}).attr("cy",function(t){return t.y}).attr("r",function(t){return 50*Math.sqrt(t[e]/p)});var i=d3.select("body").append("div").attr("class","my-popup");c.on("mouseover",function(t){i.transition().duration(50).style("left",d3.event.pageX-20+"px").style("top",d3.event.pageY-10+"px").style("opacity",1).style("text-align","left"),i.html("\n\t\t\t\t\t\t\t<div><strong>".concat(t.libgeo,"</strong></div>\n\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t<div>Taux d'évolution de la population</div>\n\t\t\t\t\t\t\t\t<em>Total</em> : <span>").concat(j(t[a])," % </span>\n\t\t\t\t\t\t\t\t<br>\n\t\t\t\t\t\t\t\t<em>Due au solde naturel</em> : <span>").concat(j(t[r])," % </span>\n\t\t\t\t\t\t\t\t<br>\n\t\t\t\t\t\t\t\t<em>Due au solde migratoire</em> : <span>").concat(j(t[n])," % </span>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t")),d3.select(this).attr("fill-opacity",.7)}).on("mouseout",function(t){i.transition().duration(100).style("opacity",0),d3.select(this).attr("fill-opacity",1)})}y.append("rect").attr("x",function(t,e){return 3*M/7+30*e}).attr("y",k/2+20).attr("width",23).attr("height",12).style("stroke","black").style("stroke-width",.1).style("fill",function(t){return t}),y.append("text").attr("x",function(t,e){return 3*M/7+30*e}).attr("dx",-5).attr("y",k/2+40).attr("dy","0.5em").attr("text-anchor","middle").attr("fill","#f0f0f0").text(function(t,e){return j(x.domain()[e])}),q.append("text").attr("x",3*M/7+150).attr("dx",-5).attr("y",k/2+40).attr("dy","0.5em").attr("text-anchor","middle").attr("fill","#f0f0f0").text(j(x.domain()[5])),q.append("text").attr("x",3*M/7-40).attr("y",k/2+5).attr("text-anchor","start").attr("fill","#f0f0f0").text("Taux de croissance annuel moyen (%)");var _=q.append("g").attr("class","circle-legend");_.append("text").attr("class","label-circle").attr("x",6*M/7).attr("y",20).attr("fill","#f0f0f0").text("Population"),_.append("circle").attr("cx",6*M/7).attr("cy",k/2+45).attr("r",50*Math.sqrt(p/p)),_.append("circle").attr("cx",6*M/7).attr("cy",k/2+40+50*Math.sqrt(2e7/p)/2).attr("r",50*Math.sqrt(2e7/p)),_.append("circle").attr("cx",6*M/7).attr("cy",k/2+40+50*Math.sqrt(2e7/p)).attr("r",50*Math.sqrt(5e6/p)),_.append("text").attr("class","label-circle").attr("x",6*M/7).attr("y",k/3+5).text("39 M"),_.append("text").attr("class","label-circle").attr("x",6*M/7).attr("y",k/2+50*Math.sqrt(2e7/p)/2-3).text("5 M"),_.append("text").attr("class","label-circle").attr("x",6*M/7).attr("y",k/2+15+50*Math.sqrt(2e7/p)).text("1 M"),h("pop_2014","tx_pop_2014","tx_pop_sn_2014","tx_pop_sm_2014",inputValues3Min[5]),deplaceOutputBullet3Min(),input07Min.addEventListener("input",function(t){switch(deplaceOutputBullet3Min(),t.target.value){case"0":d3.select(b).selectAll(".label-change2").remove(),h("pop_1975","tx_pop_1975","tx_pop_sn_1975","tx_pop_sm_1975",inputValues3Min[0]);break;case"1":d3.select(b).selectAll(".label-change2").remove(),h("pop_1982","tx_pop_1982","tx_pop_sn_1982","tx_pop_sm_1982",inputValues3Min[1]);break;case"2":d3.select(b).selectAll(".label-change2").remove(),h("pop_1990","tx_pop_1990","tx_pop_sn_1990","tx_pop_sm_1990",inputValues3Min[2]);break;case"3":d3.select(b).selectAll(".label-change2").remove(),h("pop_1999","tx_pop_1999","tx_pop_sn_1999","tx_pop_sm_1999",inputValues3Min[3]);break;case"4":d3.select(b).selectAll(".label-change2").remove(),h("pop_2009","tx_pop_2009","tx_pop_sn_2009","tx_pop_sm_2009",inputValues3Min[4]);break;case"5":d3.select(b).selectAll(".label-change2").remove(),h("pop_2014","tx_pop_2014","tx_pop_sn_2014","tx_pop_sm_2014",inputValues3Min[5])}})})}function graph8Min(){var n=document.querySelector("#object-08-min");n.addEventListener("load",function(){var t=document.querySelector(".niv2 p").clientWidth,e=n.getSVGDocument().querySelector("#svg-08-section6"),a=n.getSVGDocument().querySelectorAll(".csp-flow");n.getSVGDocument().querySelector("#carte_complete");function r(t){for(var e=0;e<a.length;e++)t!=e?a[e].setAttribute("opacity",0):a[e].setAttribute("opacity",1)}e.setAttribute("width",t),e.setAttribute("height",440),d3.select("#toolbar-08").selectAll(".button").on("click",function(){d3.selectAll(".button").classed("active",!1);var t=d3.select(this);switch(t.classed("active",!0),t.attr("id")){case"csp-all":r(0);break;case"csp-cadres":r(1);break;case"csp-retraites":r(2);break;case"csp-etudiants":r(3);break;case"csp-ouvriers":r(4)}})})}function graph10Min(m){var g=20,x=document.querySelector(".niv2 p").clientWidth,v=d3.select(m).append("svg").attr("height",400).attr("width",x);d3.formatDefaultLocale({decimal:",",thousands:" ",grouping:[3]}),Promise.all([d3.json("data/map/epci.json"),d3.json("data/map/epci_reg.json"),d3.csv("data/csv/data-10.csv")]).then(function(t){for(var e=topojson.feature(t[0],t[0].objects.epci_gen),a=topojson.feature(t[1],t[1].objects.epci_reg_gen),r=0;r<t[2].length;r++)for(var n=t[2][r].codepci,l=0;l<e.features.length;l++){if(n===e.features[l].properties.codepci){e.features[l].properties.clust=t[2][r].clust,e.features[l].properties.cat=t[2][r].cat;break}}var o=d3.scaleOrdinal().domain(["1","2","3","4","5","6"]).range(["#53995c","#7cc18b","#e8e774","#eec05d","#c4431d","#e08343"]),s=d3.geoConicConformal().fitSize([x,400],e),c=d3.geoPath().projection(s),i=v.append("g"),d=i.append("g").attr("class","c-epci").selectAll(".epci").data(e.features).join("path").attr("d",c).attr("class","epci").attr("stroke","white").attr("stroke-width",.1).attr("fill",function(t){return o(t.properties.clust)});i.append("g").attr("class","c-reg").append("path").datum(a).attr("d",c).attr("class","region");function p(){d3.select("#c-svg-10-legend").selectAll("*").remove();var a=["Retraités","Profil diversifié, plutôt âgé","Ouvriers et jeunes enfants","Employés et ouvriers","Jeunes adultes, étudiants et cadres","Trentenaires, cadres et prof. int."],t=d3.select("#c-svg-10-legend").append("svg").attr("width",x).attr("height",125).selectAll(".legend").data(o.range()).enter().append("g").attr("class","legend");t.append("rect").attr("x",x/3+30).attr("y",function(t,e){return 20*e+10}).attr("width",23).attr("height",12).style("stroke","black").style("stroke-width",.1).style("fill",function(t){return t}),t.append("text").attr("fill","#f0f0f0").attr("x",x/3+60).attr("y",function(t,e){return 15+20*e}).attr("dy","0.5em").text(function(t,e){return a[e]})}v.append("line").attr("class","extra line-extra").attr("x1",g).attr("y1",5).attr("x2",180+g).attr("y2",5).attr("stroke","#fff"),v.append("line").attr("class","extra line-extra").attr("x1",g).attr("y1",35).attr("x2",180+g).attr("y2",35).attr("stroke","#fff"),p(),v.call(d3.zoom().scaleExtent([1,6]).translateExtent([[0,0],[x,400]]).on("zoom",function(){i.attr("transform",d3.event.transform)}).on("start",function(){d.on("mouseover",null)}).on("end",function(){d.on("mouseover",function(t){u.transition().duration(50).style("left",d3.event.pageX-20+"px").style("top",d3.event.pageY-30+"px").style("opacity",1).style("text-align","left"),u.html("\n\t\t\t\t\t\t\t<div><strong>".concat(t.properties.libepci,"</strong></div>\n\t\t\t\t\t\t\t")),d3.select(this).attr("fill-opacity",.7)})}));var u=d3.select("body").append("div").attr("class","my-popup");function f(t,e){v.append("text").attr("fill","#f0f0f0").attr("class","extra label-change").attr("x",g).attr("y",25).text(t).attr("fill",e)}switch(d.on("mouseover",function(t){console.log(t),u.transition().duration(50).style("left",d3.event.pageX-20+"px").style("top",d3.event.pageY-30+"px").style("opacity",1).style("text-align","left"),u.html("\n\t\t\t\t\t\t<div><strong>".concat(t.properties.libepci,"</strong></div>\n\t\t\t\t\t\t")),d3.select(this).attr("fill-opacity",.7)}).on("mouseout",function(t){u.transition().duration(100).style("opacity",0),d3.select(this).attr("fill-opacity",1)}),m){case"#c-svg-10-min-1":p(),d3.select(m).selectAll(".label-change").remove(),f("Toutes catégories","#fff"),d.attr("fill",function(t){return o(t.properties.clust)});break;case"#c-svg-10-min-2":d3.select(m).selectAll(".label-change").remove(),f("Jeunes adultes, étudiants et cadres",o.range()[4]),d.attr("fill",function(t){return 5==t.properties.clust?o.range()[4]:"#646464"});break;case"#c-svg-10-min-3":d3.select(m).selectAll(".label-change").remove(),f("Trentenaires, cadres et prof. int.",o.range()[5]),d.attr("fill",function(t){return 6==t.properties.clust?o.range()[5]:"#646464"});break;case"#c-svg-10-min-4":d3.select(m).selectAll(".label-change").remove(),f("Employés et ouvriers",o.range()[3]),d.attr("fill",function(t){return 4==t.properties.clust?o.range()[3]:"#646464"});break;case"#c-svg-10-min-5":d3.select(m).selectAll(".label-change").remove(),f("Ouvriers et jeunes enfants",o.range()[2]),d.attr("fill",function(t){return 3==t.properties.clust?o.range()[2]:"#646464"});break;case"#c-svg-10-min-6":d3.select(m).selectAll(".label-change").remove(),f("Profil diversifié, plutôt âgé",o.range()[1]),d.attr("fill",function(t){return 2==t.properties.clust?o.range()[1]:"#646464"});break;case"#c-svg-10-min-7":d3.select("#c-svg-10-legend").selectAll("*").remove(),d3.select("#c-svg-10").selectAll(".label-change").remove(),f("Retraités",o.range()[0]),d.attr("fill",function(t){return 1==t.properties.clust?o.range()[0]:"#646464"})}})}function graph11Min(x){var v=20,y=document.querySelector(".niv2 p").clientWidth,h=d3.select(x).append("svg").attr("height",400).attr("width",y);d3.formatDefaultLocale({decimal:",",thousands:" ",grouping:[3]}),Promise.all([d3.json("data/map/epci.json"),d3.json("data/map/epci_reg.json"),d3.csv("data/csv/data-11.csv")]).then(function(t){for(var e=d3.scaleOrdinal().domain(["0_0","0_1","1_0","1_1",""]).range(["#ddb544","#d077a8","#e5484e","#7d84c0","#646464"]),a=topojson.feature(t[0],t[0].objects.epci_gen),r=topojson.feature(t[1],t[1].objects.epci_reg_gen),n=0;n<t[2].length;n++)for(var l=t[2][n].codepci,o=0;o<a.features.length;o++){if(l===a.features[o].properties.codepci){a.features[o].properties.cat_cs3=t[2][n].cat_cs3,a.features[o].properties.cat_cs6=t[2][n].cat_cs6,a.features[o].properties.cat_cs7=t[2][n].cat_cs7,a.features[o].properties.cat_cs8=t[2][n].cat_cs8,a.features[o].properties.lib_cs3=t[2][n].lib_cs3,a.features[o].properties.lib_cs6=t[2][n].lib_cs6,a.features[o].properties.lib_cs7=t[2][n].lib_cs7,a.features[o].properties.lib_cs8=t[2][n].lib_cs8;break}}var s=d3.geoConicConformal().fitSize([y,400],a),c=d3.geoPath().projection(s),i=h.append("g"),d=i.append("g").attr("class","c-epci").selectAll(".epci").data(a.features).join("path").attr("d",c).attr("class","epci").attr("stroke","white").attr("stroke-width",.1).attr("fill","#646464");i.append("g").attr("class","c-reg").append("path").datum(r).attr("d",c).attr("class","region");h.call(d3.zoom().scaleExtent([1,6]).translateExtent([[0,0],[y,400]]).on("zoom",function(){i.attr("transform",d3.event.transform)}).on("start",function(){d.on("mouseover",null)}).on("end",function(){switch(document.querySelector("#label-change-csp").textContent){case"Groupes socioprofessionnels":m("");break;case"Étudiants":m("lib_cs8");break;case"Retraités":m("lib_cs7");break;case"Ouvriers et employés":m("lib_cs6");break;case"Cadres et prof. int. sup.":m("lib_cs3")}})),h.append("line").attr("class","extra line-extra").attr("x1",v).attr("y1",5).attr("x2",180+v).attr("y2",5).attr("stroke","#fff"),h.append("line").attr("class","extra line-extra").attr("x1",v).attr("y1",35).attr("x2",180+v).attr("y2",35).attr("stroke","#fff");var p=["Faible part du groupe et forte baisse de cette part","Forte part du groupe et forte baisse de cette part","Faible aprt du groupe et forte hausse de cette part","Forte part du groupe et forte hausse de cette part"],u=d3.select("#c-svg-11-legend").append("svg").attr("width",y).attr("height",85).selectAll(".legend").data(e.range()).enter().append("g").attr("class","legend");u.append("rect").attr("x",y/3-20).attr("y",function(t,e){return 20*e+10}).attr("width",23).attr("height",12).style("stroke","black").style("stroke-width",.1).style("fill",function(t){return t}),u.append("text").attr("fill","#f0f0f0").attr("x",y/3+10).attr("y",function(t,e){return 15+20*e}).attr("dy","0.5em").text(function(t,e){return p[e]});var f=d3.select("body").append("div").attr("class","my-popup");function m(e){d.on("mouseover",function(t){f.transition().duration(50).style("left",d3.event.pageX-20+"px").style("top",d3.event.pageY-30+"px").style("opacity",1).style("text-align","left"),f.html("\n\t\t\t\t\t\t\t<div><strong>".concat(t.properties.libepci,"</strong></div>\n\t\t\t\t\t\t\t<div>").concat(t.properties[e],"</div>\n\t\t\t\t\t\t\t")),d3.select(this).attr("fill-opacity",.7)}).on("mouseout",function(t){f.transition().duration(100).style("opacity",0),d3.select(this).attr("fill-opacity",1)})}function g(t){h.append("text").attr("class","extra label-change").attr("id","label-change-csp").attr("x",v).attr("y",25).attr("fill","#fff").text(t)}switch(x){case"#c-svg-11-min-1":d3.select("#c-svg-11").selectAll(".label-change").remove(),g("Étudiants"),m("lib_cs8"),d.attr("fill",function(t){return e(t.properties.cat_cs8)});break;case"#c-svg-11-min-2":d3.select("#c-svg-11").selectAll(".label-change").remove(),g("Retraités"),m("lib_cs7"),d.attr("fill",function(t){return e(t.properties.cat_cs7)});break;case"#c-svg-11-min-3":d3.select("#c-svg-11").selectAll(".label-change").remove(),g("Ouvriers et employés"),m("lib_cs6"),d.attr("fill",function(t){return e(t.properties.cat_cs6)});break;case"#c-svg-11-min-4":d3.select("#c-svg-11").selectAll(".label-change").remove(),g("Cadres et prof. int. sup."),m("lib_cs3"),d.attr("fill",function(t){return e(t.properties.cat_cs3)})}})}window.addEventListener("resize",function(){deplaceOutputBullet3Min()}),window.addEventListener("load",function(){"block"==getComputedStyle(document.querySelector(".c-graphic-min")).display&&graph7Min("#c-svg-07-min")}),graph8Min(),window.addEventListener("load",function(){"block"==getComputedStyle(document.querySelector(".c-graphic-min")).display&&(graph10Min("#c-svg-10-min-1"),graph10Min("#c-svg-10-min-2"),graph10Min("#c-svg-10-min-3"),graph10Min("#c-svg-10-min-4"),graph10Min("#c-svg-10-min-5"),graph10Min("#c-svg-10-min-6"),graph10Min("#c-svg-10-min-7"))}),window.addEventListener("load",function(){"block"==getComputedStyle(document.querySelector(".c-graphic-min")).display&&(graph11Min("#c-svg-11-min-1"),graph11Min("#c-svg-11-min-2"),graph11Min("#c-svg-11-min-3"),graph11Min("#c-svg-11-min-4"))});
//# sourceMappingURL=../maps/script-min.js.map
